# Web Embedding åˆ†å±åŠŸèƒ½æµç¨‹æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Web Embedding é¡¹ç›®çš„åˆ†å±åŠŸèƒ½å®ç°åŸç†å’Œè°ƒç”¨æµç¨‹ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿç†è§£ç³»ç»Ÿæ¶æ„ã€‚

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [åˆ†å±è°ƒç”¨æµç¨‹](#åˆ†å±è°ƒç”¨æµç¨‹)
   - [åˆå§‹åŒ–æµç¨‹](#åˆå§‹åŒ–æµç¨‹)
   - [åˆ›å»ºä¸»è§†å›¾æµç¨‹](#åˆ›å»ºä¸»è§†å›¾æµç¨‹)
   - [è§¦å‘åˆ†å±æµç¨‹](#è§¦å‘åˆ†å±æµç¨‹)
   - [å…³é—­åˆ†å±æµç¨‹](#å…³é—­åˆ†å±æµç¨‹)
4. [æ—¶åºå›¾](#æ—¶åºå›¾)
5. [å…³é”®ä»£ç è¯´æ˜](#å…³é”®ä»£ç è¯´æ˜)
6. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¶æ„æ¦‚è¿°

Web Embedding é‡‡ç”¨ **Electron + React + Zustand** æ¶æ„ï¼Œå¹¶ä½¿ç”¨ **ä¸‰å±‚åˆ†ç¦»è®¾è®¡** å®ç°åˆ†å±åŠŸèƒ½ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¸²æŸ“è¿›ç¨‹ (Renderer Process)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   HomePage   â”‚  â”‚  useSplitScreen  â”‚  â”‚   MainView   â”‚          â”‚
â”‚  â”‚   (é¦–é¡µ)     â”‚  â”‚   (çŠ¶æ€ç®¡ç†)     â”‚  â”‚  (ä¸»è§†å›¾)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                    â”‚                  â”‚               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                â”‚                                   â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                        â”‚  Zustand Store â”‚                          â”‚
â”‚                        â”‚ (å…¨å±€çŠ¶æ€ç®¡ç†)  â”‚                          â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                â”‚                                   â”‚
â”‚                                â–¼ IPC é€šä¿¡                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    IPC é€šä¿¡å±‚ (IPC Layer)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  IPC_CHANNELS        IPC_ROUTES        IPC_HANDLERS          â”‚  â”‚
â”‚  â”‚  â”œâ”€ create-primary    â”œâ”€ main.ts         â”œâ”€ viewService.ts    â”‚  â”‚
â”‚  â”‚  â”œâ”€ create-secondary  â””â”€ browserView.ts  â”‚   (ä¸šåŠ¡é€»è¾‘)        â”‚  â”‚
â”‚  â”‚  â””â”€ destroy-secondary                    â””â”€ BrowserView API   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ä¸»è¿›ç¨‹ (Main Process)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     ViewService                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚  â”‚
â”‚  â”‚  â”‚ PrimaryView  â”‚        â”‚ SecondaryViewâ”‚                    â”‚  â”‚
â”‚  â”‚  â”‚   (ä¸»è§†å›¾)   â”‚        â”‚   (æ¬¡çº§è§†å›¾)  â”‚                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  èŒè´£: BrowserView åˆ›å»ºã€é”€æ¯ã€è¾¹ç•Œè®¡ç®—ã€å¯¼èˆªæ‹¦æˆª              â”‚  â”‚
â”‚  â”‚  æ³¨æ„: ä¸åŒ…å« IPC ä»£ç ï¼Œçº¯ä¸šåŠ¡é€»è¾‘                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰å±‚æ¶æ„è®¾è®¡

é¡¹ç›®é‡‡ç”¨æ¸…æ™°çš„ä¸‰å±‚æ¶æ„ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡¨ç°å±‚ (Presentation Layer)                            â”‚
â”‚  src/renderer/src/                                      â”‚
â”‚  - React ç»„ä»¶ã€Zustand çŠ¶æ€ç®¡ç†                          â”‚
â”‚  - é€šè¿‡ IPC å°è£…å±‚è°ƒç”¨ä¸»è¿›ç¨‹                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  IPC å±‚ (IPC Layer)                                     â”‚
â”‚  src/ipc/ + src/renderer/src/ipc/                       â”‚
â”‚  - é€šé“å¸¸é‡: channels.ts                                â”‚
â”‚  - ä¸»è¿›ç¨‹è·¯ç”±: main.ts                                  â”‚
â”‚  - æ¸²æŸ“è¿›ç¨‹å°è£…: browserView.ts                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)                            â”‚
â”‚  src/main/services/viewService.ts                       â”‚
â”‚  - çº¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸ç›´æ¥å¤„ç† IPC                            â”‚
â”‚  - BrowserView åˆ›å»ºã€é”€æ¯ã€è¾¹ç•Œè®¡ç®—                      â”‚
â”‚  - å¯¼èˆªæ‹¦æˆªå’Œäº‹ä»¶ç›‘å¬                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Electron API å±‚ (Electron API)                         â”‚
â”‚  BrowserView, BrowserWindow, ipcMain, ipcRenderer       â”‚
â”‚  - åº•å±‚ Electron API è°ƒç”¨                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿›ç¨‹èŒè´£åˆ’åˆ†

| å±‚çº§           | èŒè´£                         | å…³é”®æ–‡ä»¶                                   |
| -------------- | ---------------------------- | ------------------------------------------ |
| **è¡¨ç°å±‚**     | UI æ¸²æŸ“ã€çŠ¶æ€ç®¡ç†ã€ç”¨æˆ·äº¤äº’  | React, Zustand, `useSplitScreenStore.ts`   |
| **IPC å±‚**     | é€šä¿¡è·¯ç”±ã€ç±»å‹å®‰å…¨ã€é€šé“ç®¡ç† | `channels.ts`, `main.ts`, `browserView.ts` |
| **ä¸šåŠ¡é€»è¾‘å±‚** | BrowserView ç®¡ç†ã€å¯¼èˆªæ‹¦æˆª   | `viewService.ts`                           |
| **API å±‚**     | Electron åŸç”ŸåŠŸèƒ½            | BrowserView, ipcMain                       |

---

## æ ¸å¿ƒæ¦‚å¿µ

### 1. BrowserView

Electron æä¾›çš„ **BrowserView** ç”¨äºåœ¨çª—å£ä¸­åµŒå…¥ç½‘é¡µå†…å®¹ï¼Œç›¸æ¯” iframe å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- âœ… ç‹¬ç«‹æ¸²æŸ“è¿›ç¨‹ï¼Œæ€§èƒ½æ›´å¥½
- âœ… æ”¯æŒ `webContents` API ç²¾ç»†æ§åˆ¶
- âœ… å¯æ‹¦æˆª `will-navigate` äº‹ä»¶
- âœ… æ— è·¨åŸŸé™åˆ¶

### 2. åŒè§†å›¾æ¶æ„

ç³»ç»Ÿç»´æŠ¤ä¸¤ä¸ª BrowserView å®ä¾‹ï¼š

- **Primary View (ä¸»è§†å›¾)**: å·¦ä¾§çª—å£ï¼ŒåŠ è½½ç”¨æˆ·åˆå§‹é€‰æ‹©çš„ç½‘ç«™
- **Secondary View (æ¬¡çº§è§†å›¾)**: å³ä¾§çª—å£ï¼Œæ˜¾ç¤ºä»ä¸»è§†å›¾ç‚¹å‡»çš„é“¾æ¥

### 3. çŠ¶æ€ç®¡ç† (Zustand)

ä½¿ç”¨ **Zustand** ç®¡ç†åˆ†å±çŠ¶æ€ï¼Œé›†ä¸­å¼ç®¡ç†ï¼š

```typescript
interface SplitScreenState {
  isSplit: boolean // æ˜¯å¦å¤„äºåˆ†å±æ¨¡å¼
  primaryUrl: string | null // ä¸»è§†å›¾å½“å‰ URL
  isPrimaryViewCreated: boolean // ä¸»è§†å›¾æ˜¯å¦å·²åˆ›å»º
  splitRatio: number // åˆ†å±æ¯”ä¾‹ (é»˜è®¤ 0.5)
  windowSize: WindowSize // çª—å£å°ºå¯¸
}
```

### 4. IPC æ¶æ„

**æ ¸å¿ƒåŸåˆ™**: æ‰€æœ‰ IPC é€šä¿¡å¿…é¡»é€šè¿‡ `channels.ts` ä¸­å®šä¹‰çš„å¸¸é‡ï¼Œç¦æ­¢ç¡¬ç¼–ç å­—ç¬¦ä¸²ã€‚

```typescript
// src/ipc/channels.ts
export const IPC_CHANNELS = {
  CREATE_PRIMARY_VIEW: 'create-primary-view',
  CREATE_SECONDARY_VIEW: 'create-secondary-view',
  DESTROY_SECONDARY_VIEW: 'destroy-secondary-view',
  UPDATE_VIEW_BOUNDS: 'update-view-bounds'
  // ... å…¶ä»–é€šé“
} as const
```

---

## åˆ†å±è°ƒç”¨æµç¨‹

### åˆå§‹åŒ–æµç¨‹

åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„åˆå§‹åŒ–é¡ºåºï¼š

```
1. ä¸»è¿›ç¨‹å¯åŠ¨ (main/index.ts)
   â””â”€ åˆ›å»º BrowserWindow
   â””â”€ åˆå§‹åŒ– ViewService (ä¸šåŠ¡é€»è¾‘å±‚)
   â””â”€ æ³¨å†Œ IPC è·¯ç”± (ipc/main.ts)

2. æ¸²æŸ“è¿›ç¨‹å¯åŠ¨ (renderer/main.tsx)
   â””â”€ åŠ è½½ React åº”ç”¨
   â””â”€ åˆå§‹åŒ– Zustand Store
   â””â”€ æ˜¾ç¤º HomePage é¦–é¡µ
```

**å…³é”®ä»£ç ** (`src/main/index.ts`):

```typescript
app.whenReady().then(() => {
  // 1. åˆ›å»ºä¸»çª—å£
  const mainWindow = createWindow()

  // 2. åˆå§‹åŒ–ä¸šåŠ¡é€»è¾‘å±‚ (ViewService)
  const viewService = new ViewService(mainWindow)

  // 3. åˆå§‹åŒ– IPC è·¯ç”±ï¼Œå°†ä¸šåŠ¡å±‚æ³¨å…¥ IPC å±‚
  setupIpcHandlers(viewService)
})
```

---

### åˆ›å»ºä¸»è§†å›¾æµç¨‹

ç”¨æˆ·ä»é¦–é¡µé€‰æ‹©ç½‘ç«™åï¼Œåˆ›å»ºä¸» BrowserView çš„å®Œæ•´æµç¨‹ï¼š

```
ç”¨æˆ·ç‚¹å‡»ç½‘ç«™
    â”‚
    â–¼
HomePage.onNavigate(url)
    â”‚
    â–¼
useSplitScreenStore.navigate(url)
    â”‚
    â”œâ”€ setPrimaryUrl(url) [æ›´æ–° Zustand çŠ¶æ€]
    â”‚
    â–¼ (å»¶è¿Ÿ 100ms ç¡®ä¿ DOM æ¸²æŸ“)
è®¡ç®—å®¹å™¨ä½ç½® (getElementBounds)
    â”‚
    â–¼ IPC è°ƒç”¨ (æ¸²æŸ“å±‚ â†’ IPC å±‚)
browserViewIPC.createPrimary(url, bounds)
    â”‚
    â–¼ IPC è·¯ç”± (ipc/main.ts)
ipcMain.handle(IPC_CHANNELS.CREATE_PRIMARY_VIEW, ...)
    â”‚
    â–¼ ä¸šåŠ¡é€»è¾‘å±‚ (viewService.ts)
ViewService.createPrimaryView(url, bounds)
    â”‚
    â”œâ”€ åˆ›å»ºæ–°çš„ BrowserView å®ä¾‹
    â”œâ”€ è®¾ç½®ä½ç½®å’Œå¤§å° (setBounds)
    â”œâ”€ æ·»åŠ åˆ°ä¸»çª—å£ (addBrowserView)
    â”œâ”€ åŠ è½½ URL (loadURL)
    â””â”€ ç›‘å¬ will-navigate äº‹ä»¶
    â”‚
    â–¼
ä¸»è§†å›¾æ˜¾ç¤ºç½‘ç«™å†…å®¹
```

**å…³é”®ä»£ç ** (`src/renderer/src/hooks/useSplitScreenStore.ts`):

```typescript
navigate: async (url: string) => {
  // 1. æ›´æ–°çŠ¶æ€
  set({ primaryUrl: url })

  // 2. å»¶è¿Ÿåˆ›å»º BrowserView
  setTimeout(() => {
    const bounds = getElementBounds(primaryContainerRef.current)
    // 3. é€šè¿‡ IPC å±‚è°ƒç”¨
    browserViewIPC.createPrimary(url, bounds)
    set({ isPrimaryViewCreated: true })
  }, 100)
}
```

**å…³é”®ä»£ç ** (`src/main/services/viewService.ts`):

```typescript
/**
 * åˆ›å»ºä¸»è§†å›¾ BrowserView
 * @param url - è¦åŠ è½½çš„ç½‘ç«™ URL
 * @param bounds - è§†å›¾è¾¹ç•Œ {x, y, width, height}
 * @returns åˆ›å»ºçš„ BrowserView å®ä¾‹ ID
 */
createPrimaryView(url: string, bounds: ViewBounds): string {
  // 1. æ¸…ç†æ—§è§†å›¾
  if (this.primaryView) {
    this.destroyPrimaryView()
  }

  // 2. åˆ›å»ºæ–°è§†å›¾
  const view = new BrowserView({
    webPreferences: { sandbox: true }
  })

  // 3. è®¾ç½®ä½ç½®å’ŒåŠ è½½ URL
  view.setBounds(bounds)
  this.mainWindow.addBrowserView(view)
  view.webContents.loadURL(url)

  // 4. ç›‘å¬å¯¼èˆªäº‹ä»¶ï¼ˆè§¦å‘åˆ†å±çš„å…³é”®ï¼‰
  view.webContents.on('will-navigate', (event, url) => {
    event.preventDefault()
    this.handleNavigation(url)
  })

  // 5. å­˜å‚¨å¼•ç”¨
  this.primaryView = view
  return 'primary'
}
```

---

### è§¦å‘åˆ†å±æµç¨‹

ç”¨æˆ·åœ¨ä¸»è§†å›¾ä¸­ç‚¹å‡»é“¾æ¥æ—¶ï¼Œè‡ªåŠ¨è§¦å‘åˆ†å±çš„æ ¸å¿ƒæœºåˆ¶ï¼š

```
ç”¨æˆ·åœ¨ä¸»è§†å›¾ç‚¹å‡»é“¾æ¥
    â”‚
    â–¼ è§¦å‘äº‹ä»¶
PrimaryView.webContents.on('will-navigate', ...)
    â”‚
    â–¼ é˜»æ­¢é»˜è®¤å¯¼èˆª
event.preventDefault()
    â”‚
    â–¼ ä¸šåŠ¡é€»è¾‘å±‚
ViewService.handleNavigation(url)
    â”‚
    â”œâ”€ è®¡ç®—ä¸»è§†å›¾å½“å‰è¾¹ç•Œ
    â”œâ”€ è®¡ç®—æ¬¡çº§è§†å›¾ä½ç½® (å³ä¾§ 50%)
    â”‚
    â–¼
ViewService.createSecondaryView(url, bounds)
    â”‚
    â”œâ”€ åˆ›å»ºæ¬¡çº§ BrowserView
    â”œâ”€ è®¾ç½®ä½ç½® (ä¸»è§†å›¾å³ä¾§)
    â””â”€ åŠ è½½æ–° URL
    â”‚
    â–¼ IPC é€šçŸ¥ (é€šè¿‡ä¸»çª—å£é€šçŸ¥æ¸²æŸ“è¿›ç¨‹)
mainWindow.webContents.send(IPC_CHANNELS.SECONDARY_VIEW_CREATED, url)
    â”‚
    â–¼ æ¸²æŸ“è¿›ç¨‹ (Zustand Store ç›‘å¬)
useSplitScreenStore.onSecondaryViewCreated()
    â”‚
    â–¼
set({ isSplit: true }) [æ›´æ–°çŠ¶æ€]
    â”‚
    â–¼ UI æ›´æ–°
ä¸»è§†å›¾å®½åº¦å˜ä¸º 50%ï¼Œå³ä¾§æ˜¾ç¤ºæ¬¡çº§è§†å›¾
```

**å…³é”®ä»£ç ** (`src/main/services/viewService.ts`):

```typescript
/**
 * å¤„ç†å¯¼èˆªäº‹ä»¶ - æ ¸å¿ƒåˆ†å±é€»è¾‘
 * å½“ç”¨æˆ·åœ¨ä¸»è§†å›¾ç‚¹å‡»é“¾æ¥æ—¶è§¦å‘
 * @param url - ç›®æ ‡ URL
 */
private handleNavigation(url: string): void {
  // 1. è·å–ä¸»è§†å›¾å½“å‰è¾¹ç•Œ
  const primaryBounds = this.primaryView!.getBounds()
  const windowBounds = this.mainWindow.getBounds()

  // 2. è®¡ç®—æ¬¡çº§è§†å›¾è¾¹ç•Œï¼ˆå³ä¾§ 50%ï¼‰
  const secondaryBounds = {
    x: primaryBounds.x + primaryBounds.width,
    y: primaryBounds.y,
    width: windowBounds.width - primaryBounds.width,
    height: primaryBounds.height
  }

  // 3. åˆ›å»ºæ¬¡çº§è§†å›¾
  this.createSecondaryView(url, secondaryBounds)

  // 4. è°ƒæ•´ä¸»è§†å›¾å®½åº¦ä¸º 50%
  this.updateViewBounds('primary', primaryBounds, 0.5)

  // 5. é€šçŸ¥æ¸²æŸ“è¿›ç¨‹æ›´æ–°çŠ¶æ€
  this.mainWindow.webContents.send(
    IPC_CHANNELS.SECONDARY_VIEW_CREATED,
    url
  )
}
```

---

### å…³é—­åˆ†å±æµç¨‹

ç”¨æˆ·ç‚¹å‡»"å…³é—­åˆ†å±"æŒ‰é’®åçš„æ¸…ç†æµç¨‹ï¼š

```
ç”¨æˆ·ç‚¹å‡»å…³é—­æŒ‰é’®
    â”‚
    â–¼
useSplitScreenStore.closeSplit()
    â”‚
    â”œâ”€ IPC è°ƒç”¨é”€æ¯æ¬¡çº§è§†å›¾
    â”‚
    â–¼ IPC å±‚ (browserView.ts)
browserViewIPC.destroySecondary()
    â”‚
    â–¼ IPC è·¯ç”± (main.ts)
ipcMain.handle(IPC_CHANNELS.DESTROY_SECONDARY_VIEW, ...)
    â”‚
    â–¼ ä¸šåŠ¡é€»è¾‘å±‚ (viewService.ts)
ViewService.destroySecondaryView()
    â”‚
    â”œâ”€ ä»çª—å£ç§»é™¤ BrowserView
    â”œâ”€ å…³é—­ webContents
    â””â”€ æ¸…ç†å¼•ç”¨
    â”‚
    â–¼
set({ isSplit: false }) [æ›´æ–°çŠ¶æ€]
    â”‚
    â–¼ UI æ›´æ–°
ä¸»è§†å›¾æ¢å¤ 100% å®½åº¦
    â”‚
    â–¼
ViewService.updateViewBounds() [æ›´æ–° BrowserView ä½ç½®]
```

**å…³é”®ä»£ç ** (`src/main/services/viewService.ts`):

```typescript
/**
 * é”€æ¯æ¬¡çº§è§†å›¾
 * æ¸…ç†èµ„æºå¹¶æ¢å¤ä¸»è§†å›¾å…¨å®½
 */
destroySecondaryView(): void {
  if (this.secondaryView) {
    // 1. ä»çª—å£ç§»é™¤
    this.mainWindow.removeBrowserView(this.secondaryView)

    // 2. å…³é—­ webContents
    this.secondaryView.webContents.close()

    // 3. æ¸…ç†å¼•ç”¨
    this.secondaryView = null

    // 4. æ¢å¤ä¸»è§†å›¾å…¨å®½
    if (this.primaryView) {
      const windowBounds = this.mainWindow.getBounds()
      const contentBounds = this.mainWindow.getContentBounds()
      this.updateViewBounds('primary', contentBounds, 1.0)
    }
  }
}
```

---

## æ—¶åºå›¾

### 1. åº”ç”¨å¯åŠ¨æ—¶åº

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Main as ä¸»è¿›ç¨‹ (Main)
    participant ViewSvc as ViewService
    participant IPC as IPC Router
    participant Renderer as æ¸²æŸ“è¿›ç¨‹
    participant Store as Zustand Store

    User->>Main: å¯åŠ¨åº”ç”¨
    Main->>Main: app.whenReady()
    Main->>Main: åˆ›å»º BrowserWindow
    Main->>ViewSvc: new ViewService(window)
    Main->>IPC: setupIpcHandlers(viewService)
    IPC->>IPC: æ³¨å†Œ IPC è·¯ç”±
    Main->>Renderer: åŠ è½½é¡µé¢
    Renderer->>Renderer: ReactDOM.createRoot()
    Renderer->>Store: åˆå§‹åŒ– Zustand
    Renderer->>User: æ˜¾ç¤º HomePage
```

### 2. åˆ›å»ºä¸»è§†å›¾æ—¶åº

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Home as HomePage
    participant Store as Zustand Store
    participant IPCRenderer as IPC (Renderer)
    participant IPCMain as IPC (Main)
    participant ViewSvc as ViewService
    participant View as BrowserView

    User->>Home: ç‚¹å‡»ç½‘ç«™å›¾æ ‡
    Home->>Store: navigate(url)
    Store->>Store: setPrimaryUrl(url)
    Store->>Store: getElementBounds()
    Store->>IPCRenderer: browserViewIPC.createPrimary()
    IPCRenderer->>IPCMain: invoke(CREATE_PRIMARY_VIEW)
    IPCMain->>ViewSvc: createPrimaryView(url, bounds)
    ViewSvc->>ViewSvc: ç§»é™¤æ—§è§†å›¾
    ViewSvc->>View: new BrowserView()
    ViewSvc->>View: setBounds(bounds)
    ViewSvc->>View: addBrowserView()
    ViewSvc->>View: loadURL(url)
    ViewSvc->>View: æ³¨å…¥æ»šåŠ¨æ¡æ ·å¼
    View-->>ViewSvc: did-finish-load
    ViewSvc-->>IPCMain: è¿”å› viewId
    IPCMain-->>IPCRenderer: è¿”å›ç»“æœ
    IPCRenderer-->>Store: å®Œæˆå›è°ƒ
    Store->>Store: setIsPrimaryViewCreated(true)
    Store-->>User: UI æ›´æ–°æ˜¾ç¤ºä¸»è§†å›¾
```

### 3. è§¦å‘åˆ†å±æ—¶åº

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant View1 as Primary BrowserView
    participant ViewSvc as ViewService
    participant View2 as Secondary BrowserView
    participant IPCMain as IPC (Main)
    participant Store as Zustand Store
    participant UI as MainView UI

    User->>View1: ç‚¹å‡»é“¾æ¥
    View1->>ViewSvc: will-navigate äº‹ä»¶
    ViewSvc->>ViewSvc: event.preventDefault()
    ViewSvc->>ViewSvc: handleNavigation(url)
    ViewSvc->>ViewSvc: è®¡ç®—æ¬¡çº§è§†å›¾ä½ç½®
    ViewSvc->>View2: createSecondaryView(url, bounds)
    View2->>View2: setBounds()
    View2->>View2: loadURL(url)
    ViewSvc->>IPCMain: send(SECONDARY_VIEW_CREATED)
    IPCMain->>Store: è§¦å‘çŠ¶æ€æ›´æ–°
    Store->>Store: setIsSplit(true)
    Store-->>UI: isSplit = true
    UI->>UI: ä¸»è§†å›¾ width: 50%
    UI->>UI: æ˜¾ç¤ºæ¬¡çº§è§†å›¾å ä½åŒº
    UI-->>User: åˆ†å±æ•ˆæœå‘ˆç°
```

### 4. çª—å£å¤§å°è°ƒæ•´æ—¶åº

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Window as BrowserWindow
    participant ViewSvc as ViewService
    participant Store as Zustand Store
    participant View as BrowserView

    User->>Window: è°ƒæ•´çª—å£å¤§å°
    Window->>Window: resize äº‹ä»¶
    Window->>ViewSvc: recalculateViewsBounds()
    ViewSvc->>View: æ›´æ–°æ‰€æœ‰è§†å›¾ bounds
    Window-->>Store: çª—å£å¤§å°å˜åŒ–
    Store->>Store: setWindowSize()
    Store->>Store: requestAnimationFrame
    Store->>Store: updateViewBounds()
    Store->>ViewSvc: IPC update-view-bounds
    ViewSvc->>View: setBounds()
```

---

## å…³é”®ä»£ç è¯´æ˜

### 1. ä¸‰å±‚æ¶æ„å®ç°

**æ ¸å¿ƒåŸåˆ™**: ä¸šåŠ¡é€»è¾‘ã€IPC é€šä¿¡ã€Electron API ä¸‰å±‚åˆ†ç¦»ã€‚

```typescript
// âŒ ä¸å¥½çš„ä»£ç ï¼ˆä¸‰å±‚æ··åˆï¼‰
function createBrowserView(url: string) {
  const view = new BrowserView() // ç›´æ¥è°ƒç”¨ API
  view.webContents.loadURL(url)

  ipcMain.handle('navigate', () => {
    // ç›´æ¥å¤„ç† IPC
    view.webContents.loadURL(url)
  })

  view.setBounds({ x: 0, y: 0, width: 800, height: 600 }) // ç¡¬ç¼–ç 
}

// âœ… å¥½çš„ä»£ç ï¼ˆä¸‰å±‚åˆ†ç¦»ï¼‰

// 1. ä¸šåŠ¡é€»è¾‘å±‚ - viewService.ts
export class ViewService {
  private views = new Map<string, BrowserView>()

  createView(id: string, url: string): BrowserView {
    const view = new BrowserView({ webPreferences: { sandbox: true } })
    view.webContents.loadURL(url)
    this.views.set(id, view)
    return view
  }
}

// 2. IPC å±‚ - channels.ts
export const IPC_CHANNELS = {
  CREATE_BROWSER_VIEW: 'create-browser-view'
} as const

// 3. IPC è·¯ç”± - main.ts
export function setupIpcHandlers(viewService: ViewService) {
  ipcMain.handle(IPC_CHANNELS.CREATE_BROWSER_VIEW, (event, id: string, url: string) => {
    return viewService.createView(id, url)
  })
}

// 4. æ¸²æŸ“è¿›ç¨‹å°è£… - browserView.ts
export const browserViewIPC = {
  create: (id: string, url: string) => ipcRenderer.invoke(IPC_CHANNELS.CREATE_BROWSER_VIEW, id, url)
}
```

### 2. IPC é€šé“ç®¡ç†

**æ ¸å¿ƒæœºåˆ¶**: æ‰€æœ‰ IPC é€šé“å¿…é¡»ä½¿ç”¨å¸¸é‡ï¼Œç¦æ­¢ç¡¬ç¼–ç ã€‚

```typescript
// src/ipc/channels.ts
/**
 * IPC é€šé“åç§°å¸¸é‡
 * æ‰€æœ‰ IPC é€šä¿¡å¿…é¡»ä½¿ç”¨è¿™äº›å¸¸é‡ï¼Œç¦æ­¢ç¡¬ç¼–ç å­—ç¬¦ä¸²
 */
export const IPC_CHANNELS = {
  /** åˆ›å»ºä¸»è§†å›¾ */
  CREATE_PRIMARY_VIEW: 'create-primary-view',
  /** åˆ›å»ºæ¬¡çº§è§†å›¾ */
  CREATE_SECONDARY_VIEW: 'create-secondary-view',
  /** é”€æ¯æ¬¡çº§è§†å›¾ */
  DESTROY_SECONDARY_VIEW: 'destroy-secondary-view',
  /** æ›´æ–°è§†å›¾è¾¹ç•Œ */
  UPDATE_VIEW_BOUNDS: 'update-view-bounds',
  /** æ¬¡çº§è§†å›¾åˆ›å»ºå®Œæˆäº‹ä»¶ */
  SECONDARY_VIEW_CREATED: 'secondary-view-created'
} as const

// ä½¿ç”¨æ—¶
ipcMain.handle(IPC_CHANNELS.CREATE_PRIMARY_VIEW, handler)
// è€Œä¸æ˜¯
ipcMain.handle('create-primary-view', handler) // âŒ ç¦æ­¢
```

### 3. BrowserView è¾¹ç•Œè®¡ç®—

**æ ¸å¿ƒæœºåˆ¶**: BrowserView æ˜¯è¦†ç›–åœ¨æ¸²æŸ“è¿›ç¨‹ä¹‹ä¸Šçš„åŸç”Ÿæ§ä»¶ï¼Œéœ€è¦ç²¾ç¡®çš„åƒç´ åæ ‡ã€‚

```typescript
/**
 * è®¡ç®—æŒ‡å®šç±»å‹ BrowserView çš„è¾¹ç•ŒçŸ©å½¢
 * @param type - è§†å›¾ç±»å‹ï¼š'primary' | 'secondary'
 * @param containerBounds - å®¹å™¨çª—å£è¾¹ç•Œ
 * @param splitRatio - åˆ†å±æ¯”ä¾‹ï¼ˆ0-1ï¼‰ï¼Œé»˜è®¤ 0.5
 * @returns è®¡ç®—åçš„è¾¹ç•ŒçŸ©å½¢å¯¹è±¡
 */
function calculateViewBounds(
  type: ViewType,
  containerBounds: Rectangle,
  splitRatio = 0.5
): Rectangle {
  if (type === 'primary') {
    return {
      ...containerBounds,
      width: containerBounds.width * splitRatio
    }
  }

  // secondary
  return {
    ...containerBounds,
    x: containerBounds.width * splitRatio,
    width: containerBounds.width * (1 - splitRatio)
  }
}

// ä½¿ç”¨
const bounds = calculateViewBounds('primary', windowBounds, 0.5)
view.setBounds(bounds)
```

### 4. é“¾æ¥æ‹¦æˆªæœºåˆ¶

**æ ¸å¿ƒæœºåˆ¶**: ç›‘å¬ `will-navigate` äº‹ä»¶æ‹¦æˆªæ‰€æœ‰é“¾æ¥ç‚¹å‡»ï¼Œé˜»æ­¢é»˜è®¤å¯¼èˆªè¡Œä¸ºã€‚

```typescript
// viewService.ts ä¸­è®¾ç½®ç›‘å¬
private setupNavigationHandlers(view: BrowserView): void {
  // æ‹¦æˆªå¯¼èˆªäº‹ä»¶
  view.webContents.on('will-navigate', (event, url) => {
    event.preventDefault()  // é˜»æ­¢é»˜è®¤å¯¼èˆª
    this.handleNavigation(url)  // åœ¨æ¬¡çº§çª—å£æ‰“å¼€
  })

  // æ‹¦æˆªæ–°çª—å£æ‰“å¼€
  view.webContents.setWindowOpenHandler(({ url }) => {
    this.handleNavigation(url)
    return { action: 'deny' }  // é˜»æ­¢æ‰“å¼€æ–°çª—å£
  })
}
```

### 5. è‡ªå®šä¹‰æ»šåŠ¨æ¡æ³¨å…¥

**æ ¸å¿ƒæœºåˆ¶**: ä½¿ç”¨ `webContents.insertCSS()` å‘ BrowserView æ³¨å…¥è‡ªå®šä¹‰ CSSã€‚

```typescript
/**
 * å‘ BrowserView æ³¨å…¥è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼
 * @param view - ç›®æ ‡ BrowserView
 */
private injectScrollbarStyle(view: BrowserView): void {
  const scrollbarCSS = `
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: transparent;
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(59, 130, 246, 0.5);
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: rgba(59, 130, 246, 0.7);
    }
  `
  view.webContents.insertCSS(scrollbarCSS)
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆç‚¹å‡»é“¾æ¥ä¼šè§¦å‘åˆ†å±è€Œä¸æ˜¯åœ¨å½“å‰çª—å£æ‰“å¼€ï¼Ÿ

**åŸå› **: ä¸»è¿›ç¨‹ç›‘å¬äº† `will-navigate` äº‹ä»¶å¹¶è°ƒç”¨äº† `event.preventDefault()`ï¼Œé˜»æ­¢äº†é»˜è®¤å¯¼èˆªè¡Œä¸ºï¼Œæ”¹ä¸ºåˆ›å»ºæ¬¡çº§ BrowserView æ˜¾ç¤ºæ–°é¡µé¢ã€‚

**å…³é”®ä»£ç ä½ç½®**: `src/main/services/viewService.ts:handleNavigation()`

### Q2: åˆ†å±åå¦‚ä½•åŒæ­¥ä¸¤ä¸ªè§†å›¾çš„æ»šåŠ¨ä½ç½®ï¼Ÿ

**ç°çŠ¶**: å½“å‰å®ç°æœªåŒæ­¥æ»šåŠ¨ä½ç½®ï¼Œä¸¤ä¸ªè§†å›¾ç‹¬ç«‹æ»šåŠ¨ã€‚

**æ”¹è¿›å»ºè®®**: å¯é€šè¿‡ `webContents.executeJavaScript()` åœ¨é¡µé¢é—´åŒæ­¥æ»šåŠ¨äº‹ä»¶ã€‚

**å®ç°æ€è·¯**:

```typescript
// åœ¨ä¸»è§†å›¾æ»šåŠ¨æ—¶åŒæ­¥åˆ°æ¬¡çº§è§†å›¾
primaryView.webContents.on('scroll', () => {
  const scrollY = primaryView.webContents.executeJavaScript('window.scrollY')
  secondaryView.webContents.executeJavaScript(`window.scrollTo(0, ${scrollY})`)
})
```

### Q3: ä¸ºä»€ä¹ˆä½¿ç”¨ BrowserView è€Œä¸æ˜¯ iframeï¼Ÿ

**å¯¹æ¯”**:

| ç‰¹æ€§     | BrowserView      | iframe       |
| -------- | ---------------- | ------------ |
| æ€§èƒ½     | ç‹¬ç«‹è¿›ç¨‹ï¼Œæ›´å¥½   | ä¸é¡µé¢åŒè¿›ç¨‹ |
| è·¨åŸŸ     | æ— é™åˆ¶           | å—é™åˆ¶       |
| å¯¼èˆªæ‹¦æˆª | âœ… will-navigate | âŒ å›°éš¾      |
| CSP é™åˆ¶ | æ—                | æœ‰           |
| æ ·å¼æ³¨å…¥ | âœ… insertCSS     | âŒ å›°éš¾      |

### Q4: å¦‚ä½•æ·»åŠ åˆ†å±æ¯”ä¾‹è°ƒæ•´åŠŸèƒ½ï¼Ÿ

**å®ç°æ€è·¯**:

1. åœ¨ `MainView.tsx` ä¸­æ·»åŠ å¯æ‹–æ‹½çš„åˆ†å‰²çº¿ç»„ä»¶
2. ç›‘å¬é¼ æ ‡ç§»åŠ¨äº‹ä»¶è®¡ç®—æ–°çš„ `splitRatio`
3. é€šè¿‡ IPC è°ƒç”¨æ›´æ–°ä¸¤ä¸ª BrowserView çš„ bounds
4. æ›´æ–° Zustand Store ä¸­çš„ `splitRatio`

**æ¶‰åŠæ–‡ä»¶**:

- `src/renderer/src/pages/MainView.tsx` - UI åˆ†å‰²çº¿
- `src/renderer/src/hooks/useSplitScreenStore.ts` - çŠ¶æ€ç®¡ç†
- `src/ipc/channels.ts` - æ–°å¢ IPC é€šé“
- `src/ipc/main.ts` - è·¯ç”±å¤„ç†
- `src/main/services/viewService.ts` - è¾¹ç•Œæ›´æ–°é€»è¾‘

### Q5: å¦‚ä½•ä¿å­˜åˆ†å±é…ç½®ï¼Ÿ

**å®ç°æ€è·¯**:

1. ä½¿ç”¨ `electron-store` ä¿å­˜é…ç½®
2. ä¿å­˜å†…å®¹ï¼š
   - å¸¸ç”¨ç½‘ç«™åˆ—è¡¨
   - ä¸Šæ¬¡ä½¿ç”¨çš„åˆ†å±æ¯”ä¾‹
   - çª—å£ä½ç½®å’Œå¤§å°
3. åœ¨åº”ç”¨å¯åŠ¨æ—¶è¯»å–é…ç½®æ¢å¤çŠ¶æ€

**æ¶‰åŠæ–‡ä»¶**:

- æ–°å»º `src/main/services/configService.ts` - é…ç½®ç®¡ç†
- `src/main/index.ts` - å¯åŠ¨æ—¶åŠ è½½é…ç½®
- `src/renderer/src/stores/config.ts` - é¢„è®¾ç½‘ç«™é…ç½®æŒä¹…åŒ–

### Q6: å¦‚ä½•æ·»åŠ æ–°çš„ IPC åŠŸèƒ½ï¼Ÿ

**æ ‡å‡†æµç¨‹** (å¿…é¡»éµå¾ª):

1. **æ·»åŠ é€šé“å¸¸é‡** (`src/ipc/channels.ts`):

   ```typescript
   export const IPC_CHANNELS = {
     // ... ç°æœ‰é€šé“
     NEW_FEATURE: 'new-feature' // æ–°å¢
   } as const
   ```

2. **æ·»åŠ ç±»å‹å®šä¹‰** (`src/ipc/types.ts`):

   ```typescript
   export interface NewFeaturePayload {
     data: string
   }
   ```

3. **å®ç°ä¸»è¿›ç¨‹å¤„ç†** (`src/ipc/main.ts`):

   ```typescript
   ipcMain.handle(IPC_CHANNELS.NEW_FEATURE, (event, payload: NewFeaturePayload) => {
     return viewService.newFeature(payload)
   })
   ```

4. **æ·»åŠ æ¸²æŸ“è¿›ç¨‹å°è£…** (`src/renderer/src/ipc/browserView.ts`):

   ```typescript
   export const browserViewIPC = {
     // ... ç°æœ‰æ–¹æ³•
     newFeature: (data: string) => ipcRenderer.invoke(IPC_CHANNELS.NEW_FEATURE, { data })
   }
   ```

5. **åœ¨ Zustand ä¸­ä½¿ç”¨** (`src/renderer/src/hooks/useSplitScreenStore.ts`):
   ```typescript
   newFeature: async (data: string) => {
     await browserViewIPC.newFeature(data)
     set({
       /* æ›´æ–°çŠ¶æ€ */
     })
   }
   ```

---

## é™„å½•ï¼šæ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ ipc/                           # IPC é€šä¿¡å±‚ï¼ˆæ–°å¢ï¼‰â­
â”‚   â”œâ”€â”€ channels.ts                # IPC é€šé“åç§°å¸¸é‡
â”‚   â”œâ”€â”€ types.ts                   # IPC ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ main.ts                    # ä¸»è¿›ç¨‹ IPC è·¯ç”±å™¨
â”œâ”€â”€ main/                          # Electron ä¸»è¿›ç¨‹
â”‚   â”œâ”€â”€ index.ts                   # ä¸»è¿›ç¨‹å…¥å£
â”‚   â””â”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡å±‚ï¼ˆæ–°å¢ï¼‰â­
â”‚       â””â”€â”€ viewService.ts         # BrowserView çº¯ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ preload/                       # Electron é¢„åŠ è½½è„šæœ¬
â”‚   â”œâ”€â”€ index.ts                   # é¢„åŠ è½½å…¥å£
â”‚   â””â”€â”€ index.d.ts                 # ç±»å‹å£°æ˜
â””â”€â”€ renderer/src/                  # React æ¸²æŸ“å™¨è¿›ç¨‹
    â”œâ”€â”€ components/                # React ç»„ä»¶
    â”œâ”€â”€ hooks/                     # è‡ªå®šä¹‰ Hooks
    â”‚   â””â”€â”€ useSplitScreenStore.ts # Zustand çŠ¶æ€ç®¡ç† â­
    â”œâ”€â”€ ipc/                       # æ¸²æŸ“è¿›ç¨‹ IPC å°è£…ï¼ˆæ–°å¢ï¼‰
    â”‚   â””â”€â”€ browserView.ts         # BrowserView IPC ç±»å‹å®‰å…¨å°è£…
    â”œâ”€â”€ pages/                     # é¡µé¢ç»„ä»¶
    â”‚   â”œâ”€â”€ Home.tsx               # é¦–é¡µ
    â”‚   â””â”€â”€ MainView.tsx           # ä¸»è§†å›¾
    â”œâ”€â”€ stores/                    # é…ç½®æ–‡ä»¶
    â”‚   â””â”€â”€ config.ts              # é¢„è®¾ç½‘ç«™é…ç½®
    â”œâ”€â”€ App.tsx                    # æ ¹ç»„ä»¶
    â”œâ”€â”€ main.tsx                   # æ¸²æŸ“å™¨å…¥å£
    â””â”€â”€ RouteConfig.tsx            # è·¯ç”±é…ç½®
```

**æ ¸å¿ƒæ–‡ä»¶**:

- `src/ipc/channels.ts`: IPC é€šé“å¸¸é‡å®šä¹‰
- `src/ipc/main.ts`: IPC è·¯ç”±é…ç½®
- `src/main/services/viewService.ts`: BrowserView ä¸šåŠ¡é€»è¾‘ â­
- `src/renderer/src/ipc/browserView.ts`: æ¸²æŸ“è¿›ç¨‹ IPC å°è£…
- `src/renderer/src/hooks/useSplitScreenStore.ts`: Zustand çŠ¶æ€ç®¡ç† â­
- `src/renderer/src/pages/MainView.tsx`: åˆ†å± UI æ¸²æŸ“

**å·²åˆ é™¤çš„æ–‡ä»¶**:

- `src/main/browserViewManager.ts` - å·²æ‹†åˆ†ä¸ºä¸‰å±‚æ¶æ„
- `src/renderer/src/contexts/` - å·²æ›¿æ¢ä¸º Zustand

---

_æ–‡æ¡£ç‰ˆæœ¬: 2.0_  
_æœ€åæ›´æ–°: 2026-02-01_  
_ä½œè€…: Web Embedding Team_  
_æ¶æ„ç‰ˆæœ¬: ä¸‰å±‚åˆ†ç¦»æ¶æ„ (Business â†’ IPC â†’ Electron API)_
