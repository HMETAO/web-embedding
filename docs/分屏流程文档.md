# Web Embedding åˆ†å±åŠŸèƒ½æµç¨‹æ–‡æ¡£

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ Web Embedding é¡¹ç›®çš„åˆ†å±åŠŸèƒ½å®ç°åŸç†å’Œè°ƒç”¨æµç¨‹ï¼Œå¸®åŠ©å¼€å‘äººå‘˜å¿«é€Ÿç†è§£ç³»ç»Ÿæ¶æ„ã€‚

**ç‰ˆæœ¬**: 3.0  
**ä½œè€…**: HMETAO  
**æœ€åæ›´æ–°**: 2026-02-01

---

## ğŸ“‹ ç›®å½•

1. [æ¶æ„æ¦‚è¿°](#æ¶æ„æ¦‚è¿°)
2. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
3. [åˆ†å±è°ƒç”¨æµç¨‹](#åˆ†å±è°ƒç”¨æµç¨‹)
   - [åˆå§‹åŒ–æµç¨‹](#åˆå§‹åŒ–æµç¨‹)
   - [åˆ›å»ºä¸»è§†å›¾æµç¨‹](#åˆ›å»ºä¸»è§†å›¾æµç¨‹)
   - [è§¦å‘åˆ†å±æµç¨‹](#è§¦å‘åˆ†å±æµç¨‹)
   - [å…³é—­åˆ†å±æµç¨‹](#å…³é—­åˆ†å±æµç¨‹)
4. [çŠ¶æ€åŒæ­¥æœºåˆ¶](#çŠ¶æ€åŒæ­¥æœºåˆ¶)
5. [è¾¹ç•Œè®¡ç®—ä¿®å¤](#è¾¹ç•Œè®¡ç®—ä¿®å¤)
6. [æ—¶åºå›¾](#æ—¶åºå›¾)
7. [å…³é”®ä»£ç è¯´æ˜](#å…³é”®ä»£ç è¯´æ˜)
8. [è°ƒè¯•å’Œæ’é”™æŒ‡å—](#è°ƒè¯•å’Œæ’é”™æŒ‡å—)
9. [æ€§èƒ½ä¼˜åŒ–å»ºè®®](#æ€§èƒ½ä¼˜åŒ–å»ºè®®)
10. [IPC é€šé“å®Œæ•´åˆ—è¡¨](#ipc-é€šé“å®Œæ•´åˆ—è¡¨)
11. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¶æ„æ¦‚è¿°

Web Embedding é‡‡ç”¨ **Electron + React + Zustand** æ¶æ„ï¼Œå¹¶ä½¿ç”¨ **ä¸‰å±‚åˆ†ç¦»è®¾è®¡** å®ç°åˆ†å±åŠŸèƒ½ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ¸²æŸ“è¿›ç¨‹ (Renderer Process)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   HomePage   â”‚  â”‚  useSplitScreen  â”‚  â”‚   MainView   â”‚          â”‚
â”‚  â”‚   (é¦–é¡µ)     â”‚  â”‚   (çŠ¶æ€ç®¡ç†)     â”‚  â”‚  (ä¸»è§†å›¾)    â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚           â”‚                    â”‚                  â”‚               â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â”‚                                â”‚                                   â”‚
â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚                        â”‚  Zustand Store â”‚                          â”‚
â”‚                        â”‚ (å…¨å±€çŠ¶æ€ç®¡ç†)  â”‚                          â”‚
â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                                â”‚                                   â”‚
â”‚                                â–¼ IPC é€šä¿¡                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    IPC é€šä¿¡å±‚ (IPC Layer)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  IPC_CHANNELS        IPC_ROUTES        IPC_HANDLERS          â”‚  â”‚
â”‚  â”‚  â”œâ”€ create-primary    â”œâ”€ main.ts         â”œâ”€ viewService.ts    â”‚  â”‚
â”‚  â”‚  â”œâ”€ create-secondary  â””â”€ browserView.ts  â”‚   (ä¸šåŠ¡é€»è¾‘)        â”‚  â”‚
â”‚  â”‚  â”œâ”€ destroy-secondary                    â””â”€ BrowserView API   â”‚  â”‚
â”‚  â”‚  â””â”€ get-detailed-status  â† æ–°å¢ï¼šçŠ¶æ€åŒæ­¥æœºåˆ¶                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                    ä¸»è¿›ç¨‹ (Main Process)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                     ViewService                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚  â”‚
â”‚  â”‚  â”‚ PrimaryView  â”‚        â”‚ SecondaryViewâ”‚                    â”‚  â”‚
â”‚  â”‚  â”‚   (ä¸»è§†å›¾)   â”‚        â”‚   (æ¬¡çº§è§†å›¾)  â”‚                    â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚  â”‚
â”‚  â”‚                                                              â”‚  â”‚
â”‚  â”‚  èŒè´£: BrowserView åˆ›å»ºã€é”€æ¯ã€è¾¹ç•Œè®¡ç®—ã€å¯¼èˆªæ‹¦æˆª              â”‚  â”‚
â”‚  â”‚  æ³¨æ„: ä¸åŒ…å« IPC ä»£ç ï¼Œçº¯ä¸šåŠ¡é€»è¾‘                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸‰å±‚æ¶æ„è®¾è®¡

é¡¹ç›®é‡‡ç”¨æ¸…æ™°çš„ä¸‰å±‚æ¶æ„ï¼Œå®ç°å…³æ³¨ç‚¹åˆ†ç¦»ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡¨ç°å±‚ (Presentation Layer)                            â”‚
â”‚  src/renderer/src/                                      â”‚
â”‚  - React ç»„ä»¶ã€Zustand çŠ¶æ€ç®¡ç†                          â”‚
â”‚  - é€šè¿‡ IPC å°è£…å±‚è°ƒç”¨ä¸»è¿›ç¨‹                             â”‚
â”‚  - çŠ¶æ€åŒæ­¥æœºåˆ¶ï¼ˆæŒ‚è½½ã€ç„¦ç‚¹ã€å®šæœŸï¼‰                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  IPC å±‚ (IPC Layer)                                     â”‚
â”‚  src/ipc/ + src/renderer/src/ipc/                       â”‚
â”‚  - é€šé“å¸¸é‡: channels.ts                                â”‚
â”‚  - ä¸»è¿›ç¨‹è·¯ç”±: main.ts                                  â”‚
â”‚  - æ¸²æŸ“è¿›ç¨‹å°è£…: browserView.ts                         â”‚
â”‚  - ç±»å‹å®šä¹‰: types.ts                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ä¸šåŠ¡é€»è¾‘å±‚ (Business Layer)                            â”‚
â”‚  src/main/services/viewService.ts                       â”‚
â”‚  - çº¯ä¸šåŠ¡é€»è¾‘ï¼Œä¸ç›´æ¥å¤„ç† IPC                            â”‚
â”‚  - BrowserView åˆ›å»ºã€é”€æ¯ã€è¾¹ç•Œè®¡ç®—                      â”‚
â”‚  - å¯¼èˆªæ‹¦æˆªå’Œäº‹ä»¶ç›‘å¬                                    â”‚
â”‚  - è¯¦ç»†çŠ¶æ€æŸ¥è¯¢ (getSplitStatus)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Electron API å±‚ (Electron API)                         â”‚
â”‚  BrowserView, BrowserWindow, ipcMain, ipcRenderer       â”‚
â”‚  - åº•å±‚ Electron API è°ƒç”¨                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¿›ç¨‹èŒè´£åˆ’åˆ†

| å±‚çº§           | èŒè´£                         | å…³é”®æ–‡ä»¶                                   |
| -------------- | ---------------------------- | ------------------------------------------ |
| **è¡¨ç°å±‚**     | UI æ¸²æŸ“ã€çŠ¶æ€ç®¡ç†ã€ç”¨æˆ·äº¤äº’  | React, Zustand, `useSplitScreenStore.ts`   |
| **IPC å±‚**     | é€šä¿¡è·¯ç”±ã€ç±»å‹å®‰å…¨ã€é€šé“ç®¡ç† | `channels.ts`, `main.ts`, `browserView.ts` |
| **ä¸šåŠ¡é€»è¾‘å±‚** | BrowserView ç®¡ç†ã€å¯¼èˆªæ‹¦æˆª   | `viewService.ts`                           |
| **API å±‚**     | Electron åŸç”ŸåŠŸèƒ½            | BrowserView, ipcMain                       |

---

## æ ¸å¿ƒæ¦‚å¿µ

### 1. BrowserView

Electron æä¾›çš„ **BrowserView** ç”¨äºåœ¨çª—å£ä¸­åµŒå…¥ç½‘é¡µå†…å®¹ï¼Œç›¸æ¯” iframe å…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- âœ… ç‹¬ç«‹æ¸²æŸ“è¿›ç¨‹ï¼Œæ€§èƒ½æ›´å¥½
- âœ… æ”¯æŒ `webContents` API ç²¾ç»†æ§åˆ¶
- âœ… å¯æ‹¦æˆª `will-navigate` äº‹ä»¶
- âœ… æ— è·¨åŸŸé™åˆ¶

### 2. åŒè§†å›¾æ¶æ„

ç³»ç»Ÿç»´æŠ¤ä¸¤ä¸ª BrowserView å®ä¾‹ï¼š

- **Primary View (ä¸»è§†å›¾)**: å·¦ä¾§çª—å£ï¼ŒåŠ è½½ç”¨æˆ·åˆå§‹é€‰æ‹©çš„ç½‘ç«™
- **Secondary View (æ¬¡çº§è§†å›¾)**: å³ä¾§çª—å£ï¼Œæ˜¾ç¤ºä»ä¸»è§†å›¾ç‚¹å‡»çš„é“¾æ¥

### 3. çŠ¶æ€ç®¡ç† (Zustand)

ä½¿ç”¨ **Zustand** ç®¡ç†åˆ†å±çŠ¶æ€ï¼Œé›†ä¸­å¼ç®¡ç†ï¼š

```typescript
interface SplitScreenState {
  isSplit: boolean // æ˜¯å¦å¤„äºåˆ†å±æ¨¡å¼
  primaryUrl: string | null // ä¸»è§†å›¾å½“å‰ URL
  isPrimaryViewCreated: boolean // ä¸»è§†å›¾æ˜¯å¦å·²åˆ›å»º
  splitRatio: number // åˆ†å±æ¯”ä¾‹ (é»˜è®¤ 0.5)
  windowSize: WindowSize // çª—å£å°ºå¯¸
}
```

### 4. çŠ¶æ€åŒæ­¥æœºåˆ¶ï¼ˆå…³é”®ï¼‰

ç”±äºä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„çŠ¶æ€å¯èƒ½ä¸ä¸€è‡´ï¼Œæˆ‘ä»¬å®ç°äº†**ä¸‰å±‚åŒæ­¥æœºåˆ¶**ï¼š

1. **äº‹ä»¶é©±åŠ¨åŒæ­¥**: `SECONDARY_CREATED` äº‹ä»¶é€šçŸ¥æ¸²æŸ“è¿›ç¨‹
2. **ä¸»åŠ¨æŸ¥è¯¢åŒæ­¥**: `GET_DETAILED_STATUS` IPC é€šé“ä¸»åŠ¨æŸ¥è¯¢
3. **å®šæœŸåŒæ­¥**: æ¯ 5 ç§’è‡ªåŠ¨æ£€æŸ¥ä¸€æ¬¡çŠ¶æ€

**åŒæ­¥æ—¶æœº**ï¼š

- ç»„ä»¶æŒ‚è½½åï¼ˆ500ms å»¶è¿Ÿï¼‰
- çª—å£è·å¾—ç„¦ç‚¹æ—¶
- æ¯ 5 ç§’å®šæœŸæ£€æŸ¥

### 5. è¾¹ç•Œè®¡ç®—ï¼ˆå«åˆ†å‰²çº¿å®½åº¦ï¼‰

**å…³é”®è®¾è®¡**: DOM ä¸­åˆ†å‰²çº¿å®½åº¦ä¸º **14px**ï¼ŒBrowserView è¾¹ç•Œè®¡ç®—å¿…é¡»è€ƒè™‘è¿™ä¸ªå®½åº¦ã€‚

```typescript
// DOM å¸ƒå±€
ä¸»è§†å›¾: calc(50% - 7px) + åˆ†å‰²çº¿(14px) + æ¬¡è§†å›¾: calc(50% - 7px)

// BrowserView è¾¹ç•Œè®¡ç®—
ä¸»è§†å›¾å®½åº¦: totalWidth * ratio
æ¬¡è§†å›¾ x: primaryWidth + 14
æ¬¡è§†å›¾å®½åº¦: totalWidth - primaryWidth - 14
```

---

## åˆ†å±è°ƒç”¨æµç¨‹

### åˆå§‹åŒ–æµç¨‹

åº”ç”¨å¯åŠ¨æ—¶ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çš„åˆå§‹åŒ–é¡ºåºï¼š

```
1. ä¸»è¿›ç¨‹å¯åŠ¨ (main/index.ts)
   â””â”€ åˆ›å»º BrowserWindow
   â””â”€ åˆå§‹åŒ– ViewService (ä¸šåŠ¡é€»è¾‘å±‚)
   â””â”€ æ³¨å†Œ IPC è·¯ç”± (ipc/main.ts)

2. æ¸²æŸ“è¿›ç¨‹å¯åŠ¨ (renderer/main.tsx)
   â””â”€ åŠ è½½ React åº”ç”¨
   â””â”€ åˆå§‹åŒ– Zustand Store
   â””â”€ æ˜¾ç¤º HomePage é¦–é¡µ
   â””â”€ æ³¨å†ŒçŠ¶æ€åŒæ­¥ç›‘å¬ (æŒ‚è½½åã€ç„¦ç‚¹ã€å®šæœŸ)
```

**å…³é”®ä»£ç ** (`src/main/index.ts`):

```typescript
app.whenReady().then(() => {
  // 1. åˆ›å»ºä¸»çª—å£
  const mainWindow = createWindow()

  // 2. åˆå§‹åŒ–ä¸šåŠ¡é€»è¾‘å±‚ (ViewService)
  viewService.setMainWindow(mainWindow)

  // 3. åˆå§‹åŒ– IPC è·¯ç”±
  initIPC()
})
```

---

### åˆ›å»ºä¸»è§†å›¾æµç¨‹

ç”¨æˆ·ä»é¦–é¡µé€‰æ‹©ç½‘ç«™åï¼Œåˆ›å»ºä¸» BrowserView çš„å®Œæ•´æµç¨‹ï¼š

```
ç”¨æˆ·ç‚¹å‡»ç½‘ç«™
    â”‚
    â–¼
HomePage.onNavigate(url)
    â”‚
    â–¼
useSplitScreenStore.navigate(url)
    â”‚
    â”œâ”€ setPrimaryUrl(url) [æ›´æ–° Zustand çŠ¶æ€]
    â”‚
    â–¼ (å»¶è¿Ÿ 100ms ç¡®ä¿ DOM æ¸²æŸ“)
è®¡ç®—å®¹å™¨ä½ç½® (getElementBounds)
    â”‚
    â–¼ IPC è°ƒç”¨ (æ¸²æŸ“å±‚ â†’ IPC å±‚)
browserViewIPC.createPrimary(url, bounds)
    â”‚
    â–¼ IPC è·¯ç”± (ipc/main.ts)
ipcMain.handle(IPC_CHANNELS.CREATE_PRIMARY_VIEW, ...)
    â”‚
    â–¼ ä¸šåŠ¡é€»è¾‘å±‚ (viewService.ts)
ViewService.createPrimaryView(url, bounds)
    â”‚
    â”œâ”€ åˆ›å»ºæ–°çš„ BrowserView å®ä¾‹
    â”œâ”€ è®¾ç½®ä½ç½®å’Œå¤§å° (setBounds)
    â”œâ”€ æ·»åŠ åˆ°ä¸»çª—å£ (addBrowserView)
    â”œâ”€ åŠ è½½ URL (loadURL)
    â””â”€ ç›‘å¬ will-navigate äº‹ä»¶
    â”‚
    â–¼
ä¸»è§†å›¾æ˜¾ç¤ºç½‘ç«™å†…å®¹
```

**å…³é”®ä»£ç ** (`src/renderer/src/hooks/useSplitScreenStore.ts`):

```typescript
const navigate = useCallback((url: string) => {
  setPrimaryUrl(url)

  setTimeout(() => {
    if (!primaryContainerRef.current) return
    const bounds = getElementBounds(primaryContainerRef.current)
    if (!bounds) return

    browserViewIPC.createPrimaryView(url, bounds)
    setIsPrimaryViewCreated(true)
  }, 100)
}, [])
```

**å…³é”®ä»£ç ** (`src/main/services/viewService.ts`):

```typescript
createPrimaryView(url: string, bounds: ViewBounds): void {
  // 1. æ¸…ç†æ—§è§†å›¾
  if (this.primaryView) {
    this.cleanupView(this.primaryView)
    this.primaryView = null
  }

  // 2. åˆ›å»ºæ–°è§†å›¾
  this.primaryView = new BrowserView({
    webPreferences: {
      nodeIntegration: false,
      contextIsolation: true
    }
  })

  // 3. è®¾ç½®ä½ç½®å’ŒåŠ è½½ URL
  this.primaryView.setBounds(bounds)
  this.mainWindow.addBrowserView(this.primaryView)
  this.primaryView.webContents.loadURL(url)

  // 4. ç›‘å¬å¯¼èˆªäº‹ä»¶ï¼ˆè§¦å‘åˆ†å±çš„å…³é”®ï¼‰
  this.primaryView.webContents.on('will-navigate', (event, url) => {
    event.preventDefault()
    this.handleNavigation(url)
  })

  // 5. ä¿å­˜ URL
  this.primaryUrl = url

  console.log('[ViewService] ä¸»è§†å›¾å·²åˆ›å»º:', url)
}
```

---

### è§¦å‘åˆ†å±æµç¨‹

ç”¨æˆ·åœ¨ä¸»è§†å›¾ä¸­ç‚¹å‡»é“¾æ¥æ—¶ï¼Œè‡ªåŠ¨è§¦å‘åˆ†å±çš„æ ¸å¿ƒæœºåˆ¶ï¼š

```
ç”¨æˆ·åœ¨ä¸»è§†å›¾ç‚¹å‡»é“¾æ¥
    â”‚
    â–¼ è§¦å‘äº‹ä»¶
PrimaryView.webContents.on('will-navigate', ...)
    â”‚
    â–¼ é˜»æ­¢é»˜è®¤å¯¼èˆª
event.preventDefault()
    â”‚
    â–¼ ä¸šåŠ¡é€»è¾‘å±‚
ViewService.handleNavigation(url) â† ğŸ”¥ å…³é”®ï¼šè¾¹ç•Œè®¡ç®—
    â”‚
    â”œâ”€ è·å–ä¸»è§†å›¾å½“å‰è¾¹ç•Œ
    â”œâ”€ è®¡ç®—æ¬¡çº§è§†å›¾ä½ç½® (å³ä¾§ï¼Œè€ƒè™‘ 14px åˆ†å‰²çº¿å®½åº¦)
    â”‚
    â–¼
ViewService.createSecondaryView(url, bounds)
    â”‚
    â”œâ”€ å¦‚æœå·²å­˜åœ¨ï¼šæ›´æ–° URL + å‘é€ SECONDARY_CREATED äº‹ä»¶
    â”œâ”€ å¦‚æœä¸å­˜åœ¨ï¼šåˆ›å»ºæ¬¡çº§ BrowserView
    â”‚
    â–¼ IPC é€šçŸ¥
mainWindow.webContents.send(SECONDARY_CREATED, url)
    â”‚
    â–¼ æ¸²æŸ“è¿›ç¨‹ (Zustand Store ç›‘å¬)
useSplitScreenStore.onSecondaryCreated()
    â”‚
    â–¼
setIsSplit(true) [æ›´æ–°çŠ¶æ€]
    â”‚
    â–¼ UI æ›´æ–°
ä¸»è§†å›¾å®½åº¦å˜ä¸º 50% - 7pxï¼Œå³ä¾§æ˜¾ç¤ºåˆ†å‰²çº¿ + æ¬¡çº§è§†å›¾
```

**å…³é”®ä»£ç ** (`src/main/services/viewService.ts`):

```typescript
/**
 * ğŸ”¥ å…³é”®ä¿®å¤ï¼šå¤„ç†å¯¼èˆªäº‹ä»¶
 * è¾¹ç•Œè®¡ç®—å¿…é¡»è€ƒè™‘ DOM ä¸­ 14px çš„åˆ†å‰²çº¿å®½åº¦
 */
private handleNavigation(url: string): void {
  if (!this.mainWindow || !this.primaryView) {
    console.warn('[ViewService] æ— æ³•å¤„ç†å¯¼èˆª')
    return
  }

  // è·å–ä¸»è§†å›¾çš„å½“å‰ä½ç½®
  const primaryBounds = this.primaryView.getBounds()
  const windowBounds = this.mainWindow.getBounds()
  const dividerWidth = 14 // DOM ä¸­åˆ†å‰²çº¿çš„å®½åº¦

  // ğŸ”¥ å…³é”®ä¿®å¤ï¼šè¾¹ç•Œè®¡ç®—å¿…é¡»è€ƒè™‘åˆ†å‰²çº¿å®½åº¦
  // æ¬¡è§†å›¾çš„ x åæ ‡ = ä¸»è§†å›¾å³è¾¹ç•Œ + åˆ†å‰²çº¿å®½åº¦
  // æ¬¡è§†å›¾çš„å®½åº¦ = çª—å£å®½åº¦ - ä¸»è§†å›¾å®½åº¦ - åˆ†å‰²çº¿å®½åº¦
  this.createSecondaryView(url, {
    x: primaryBounds.x + primaryBounds.width + dividerWidth,
    y: primaryBounds.y,
    width: Math.max(0, windowBounds.width - primaryBounds.width - dividerWidth),
    height: primaryBounds.height
  })

  console.log('[ViewService] å¯¼èˆªå·²æ‹¦æˆªï¼Œåœ¨æ¬¡çº§çª—å£æ‰“å¼€:', url)
}
```

**ğŸ”¥ å…³é”®ä¿®å¤ä»£ç ** (`createSecondaryView` ä¸­å·²å­˜åœ¨è§†å›¾æ—¶çš„å¤„ç†):

```typescript
// å¦‚æœå·²å­˜åœ¨ï¼Œæ›´æ–° URL å¹¶ç¡®ä¿çŠ¶æ€åŒæ­¥
if (this.secondaryView) {
  this.secondaryView.webContents.loadURL(url)
  this.updateSecondaryBounds(bounds)

  // ğŸ”¥ å…³é”®ä¿®å¤ï¼šç¡®ä¿ isSplit çŠ¶æ€æ­£ç¡®
  if (!this.isSplit) {
    this.isSplit = true
  }

  // ğŸ”¥ å…³é”®ä¿®å¤ï¼šå‘é€äº‹ä»¶ç¡®ä¿æ¸²æŸ“è¿›ç¨‹åŒæ­¥
  this.mainWindow.webContents.send(IPCChannels.BrowserView.SECONDARY_CREATED, {
    url,
    timestamp: Date.now()
  })
  return
}
```

---

### å…³é—­åˆ†å±æµç¨‹

ç”¨æˆ·ç‚¹å‡»"å…³é—­åˆ†å±"æŒ‰é’®åçš„æ¸…ç†æµç¨‹ï¼š

```
ç”¨æˆ·ç‚¹å‡»å…³é—­æŒ‰é’®
    â”‚
    â–¼
useSplitScreenStore.closeSplit()
    â”‚
    â”œâ”€ IPC è°ƒç”¨é”€æ¯æ¬¡çº§è§†å›¾
    â”œâ”€ setIsSplit(false) [ç«‹å³æ›´æ–°çŠ¶æ€]
    â”œâ”€ setSplitRatio(0.5) [é‡ç½®æ¯”ä¾‹]
    â”‚
    â–¼ IPC å±‚ (browserView.ts)
browserViewIPC.destroySecondary()
    â”‚
    â–¼ IPC è·¯ç”± (main.ts)
ipcMain.handle(IPC_CHANNELS.DESTROY_SECONDARY, ...)
    â”‚
    â–¼ ä¸šåŠ¡é€»è¾‘å±‚ (viewService.ts)
ViewService.destroySecondary()
    â”‚
    â”œâ”€ ä»çª—å£ç§»é™¤ BrowserView
    â”œâ”€ å…³é—­ webContents
    â”œâ”€ æ¸…ç†å¼•ç”¨
    â””â”€ æ¢å¤ä¸»è§†å›¾å…¨å®½
    â”‚
    â–¼
UI æ›´æ–°ï¼šä¸»è§†å›¾æ¢å¤ 100%ï¼Œæ¬¡è§†å›¾é€æ˜åº¦å˜ä¸º 0ï¼ŒèƒŒæ™¯é€æ˜
```

**å…³é”®ä»£ç ** (`src/main/services/viewService.ts`):

```typescript
destroySecondary(): void {
  if (this.secondaryView) {
    // 1. ä»çª—å£ç§»é™¤
    this.mainWindow.removeBrowserView(this.secondaryView)

    // 2. å…³é—­ webContents
    this.secondaryView.webContents.close()

    // 3. æ¸…ç†å¼•ç”¨
    this.secondaryView = null
    this.isSplit = false

    // 4. æ¢å¤ä¸»è§†å›¾å…¨å®½
    if (this.primaryView) {
      const windowBounds = this.mainWindow.getBounds()
      const height = windowBounds.height - 40 // å‡å»å¯¼èˆªæ 
      this.primaryView.setBounds({
        x: 0,
        y: 40,
        width: windowBounds.width,
        height
      })
    }

    console.log('[ViewService] æ¬¡çº§è§†å›¾å·²é”€æ¯')
  }
}
```

**ğŸ”¥ å…³é”®ä¿®å¤ä»£ç ** (MainView.tsx ä¸­çš„æ ·å¼ä¿®å¤):

```tsx
{/* æ¬¡çº§è§†å›¾å ä½åŒºåŸŸ */}
<div
  ref={secondaryContainerRef}
  style={{
    width: isSplit ? `calc(${(1 - splitRatio) * 100}% - 7px)` : '0%',
    opacity: isSplit ? 1 : 0,
    // ğŸ”¥ å…³é”®ä¿®å¤ï¼šå…³é—­åˆ†å±æ—¶ç«‹å³éšè—èƒŒæ™¯ï¼Œæ¶ˆé™¤ç™½å±é—ªçƒ
    backgroundColor: isSplit ? '#f3f4f6' : 'transparent',
    visibility: isSplit ? 'visible' : 'hidden',
    transition: isDragging ? 'none' : 'width 0.3s ease-in-out'
  }}
>
```

---

## çŠ¶æ€åŒæ­¥æœºåˆ¶

### ä¸ºä»€ä¹ˆéœ€è¦çŠ¶æ€åŒæ­¥ï¼Ÿ

**é—®é¢˜åœºæ™¯**ï¼š

1. ç”¨æˆ·å·²åˆ†å±ï¼ˆä¸»è¿›ç¨‹ `isSplit = true`ï¼Œæ¸²æŸ“è¿›ç¨‹ `isSplit = true`ï¼‰
2. ç”¨æˆ·ç‚¹å‡»ä¸»è§†å›¾é“¾æ¥ï¼ˆè§¦å‘ `handleNavigation`ï¼‰
3. `createSecondaryView` æ£€æµ‹åˆ°æ¬¡è§†å›¾å·²å­˜åœ¨ï¼Œåªæ›´æ–° URL
4. **é—®é¢˜**ï¼šç”±äºæŸäº›åŸå› ï¼Œæ¸²æŸ“è¿›ç¨‹çš„ `isSplit` è¢«æ„å¤–é‡ç½®ä¸º `false`
5. **ç»“æœ**ï¼šDOM ä¸­åˆ†å‰²çº¿ä¸æ˜¾ç¤ºï¼Œä½† BrowserView æ¬¡çº§è§†å›¾ä»ç„¶å­˜åœ¨

**è§£å†³æ–¹æ¡ˆ**ï¼šå®ç°**çŠ¶æ€åŒæ­¥æœºåˆ¶**ï¼Œç¡®ä¿ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹çŠ¶æ€ä¸€è‡´ã€‚

### ä¸‰å±‚åŒæ­¥æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ä¸‰å±‚åŒæ­¥æœºåˆ¶                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. äº‹ä»¶é©±åŠ¨åŒæ­¥ (Event-Driven)                          â”‚
â”‚     - è§¦å‘æ—¶æœº: createSecondaryView è¢«è°ƒç”¨æ—¶              â”‚
â”‚     - å®ç°æ–¹å¼: å‘é€ SECONDARY_CREATED äº‹ä»¶               â”‚
â”‚     - ä½œç”¨: é€šçŸ¥æ¸²æŸ“è¿›ç¨‹æ›´æ–° isSplit çŠ¶æ€                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  2. ä¸»åŠ¨æŸ¥è¯¢åŒæ­¥ (Active Query)                          â”‚
â”‚     - è§¦å‘æ—¶æœº: ç»„ä»¶æŒ‚è½½ã€çª—å£ç„¦ç‚¹ã€å®šæœŸ                  â”‚
â”‚     - å®ç°æ–¹å¼: GET_DETAILED_STATUS IPC è°ƒç”¨              â”‚
â”‚     - ä½œç”¨: ä¸»åŠ¨æŸ¥è¯¢ä¸»è¿›ç¨‹çŠ¶æ€ï¼Œæ£€æµ‹å¹¶ä¿®å¤ä¸ä¸€è‡´          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  3. å®šæœŸåŒæ­¥ (Periodic Sync)                             â”‚
â”‚     - è§¦å‘æ—¶æœº: æ¯ 5 ç§’è‡ªåŠ¨æ‰§è¡Œ                           â”‚
â”‚     - å®ç°æ–¹å¼: setInterval                               â”‚
â”‚     - ä½œç”¨: å…œåº•ä¿éšœï¼Œç¡®ä¿é•¿æœŸè¿è¡ŒåçŠ¶æ€ä»ç„¶ä¸€è‡´          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦ç»†å®ç°

**1. IPC é€šé“å®šä¹‰** (`src/ipc/channels.ts`):

```typescript
export const IPCChannels = {
  BrowserView: {
    // ... ç°æœ‰é€šé“
    GET_DETAILED_STATUS: 'browser-view:get-detailed-status' // ğŸ”¥ æ–°å¢
  }
}
```

**2. ç±»å‹å®šä¹‰** (`src/ipc/types.ts`):

```typescript
// è¯·æ±‚ç±»å‹
export interface IPCRequestMap {
  [IPCChannels.BrowserView.GET_DETAILED_STATUS]: never // æ— å‚æ•°
}

// å“åº”ç±»å‹
export interface IPCResponseMap {
  [IPCChannels.BrowserView.GET_DETAILED_STATUS]: {
    isSplit: boolean
    hasSecondaryView: boolean
    primaryUrl: string
    secondaryUrl: string
  }
}
```

**3. ä¸»è¿›ç¨‹å®ç°** (`src/main/services/viewService.ts`):

```typescript
/**
 * è·å–å½“å‰åˆ†å±çŠ¶æ€ï¼ˆè¯¦ç»†ï¼‰
 * ç”¨äºæ¸²æŸ“è¿›ç¨‹æŸ¥è¯¢å’ŒçŠ¶æ€åŒæ­¥
 */
getSplitStatus(): {
  isSplit: boolean
  hasSecondaryView: boolean
  primaryUrl: string
  secondaryUrl: string
} {
  return {
    isSplit: this.isSplit,
    hasSecondaryView: this.secondaryView !== null,
    primaryUrl: this.primaryUrl,
    secondaryUrl: this.secondaryUrl
  }
}
```

**4. IPC è·¯ç”±** (`src/ipc/main.ts`):

```typescript
// è·å–è¯¦ç»†çŠ¶æ€
this.register(IPCChannels.BrowserView.GET_DETAILED_STATUS, async () => {
  return viewService.getSplitStatus()
})
```

**5. æ¸²æŸ“è¿›ç¨‹å°è£…** (`src/renderer/src/ipc/browserView.ts`):

```typescript
/**
 * è·å–è¯¦ç»†åˆ†å±çŠ¶æ€
 */
async getDetailedSplitStatus(): Promise<{
  isSplit: boolean
  hasSecondaryView: boolean
  primaryUrl: string
  secondaryUrl: string
}> {
  const result = await ipc.invoke(IPCChannels.BrowserView.GET_DETAILED_STATUS)
  return result.success ? result.data! : {
    isSplit: false,
    hasSecondaryView: false,
    primaryUrl: '',
    secondaryUrl: ''
  }
}
```

**6. Hook ä¸­çš„çŠ¶æ€åŒæ­¥** (`src/renderer/src/hooks/useSplitScreenStore.ts`):

```typescript
/**
 * åŒæ­¥åˆ†å±çŠ¶æ€
 * ä¸»åŠ¨æŸ¥è¯¢ä¸»è¿›ç¨‹çŠ¶æ€å¹¶åŒæ­¥æœ¬åœ°çŠ¶æ€
 */
const syncSplitStatus = useCallback(async () => {
  if (!isPrimaryViewCreated) return

  try {
    const detailedStatus = await browserViewIPC.getDetailedSplitStatus()

    // ğŸ”¥ å…³é”®ä¿®å¤ï¼šå¦‚æœä¸»è¿›ç¨‹æœ‰æ¬¡è§†å›¾ä½†æœ¬åœ°çŠ¶æ€æ²¡æœ‰ï¼Œåˆ™åŒæ­¥
    if (detailedStatus.hasSecondaryView && !isSplit) {
      console.log('[useSplitScreen] æ£€æµ‹åˆ°çŠ¶æ€ä¸ä¸€è‡´ï¼ŒåŒæ­¥åˆ†å±çŠ¶æ€')
      setIsSplit(true)
    }

    // ğŸ”¥ å…³é”®ä¿®å¤ï¼šå¦‚æœä¸»è¿›ç¨‹æ²¡æœ‰æ¬¡è§†å›¾ä½†æœ¬åœ°çŠ¶æ€æœ‰ï¼Œåˆ™é‡ç½®
    if (!detailedStatus.hasSecondaryView && isSplit) {
      console.log('[useSplitScreen] æ£€æµ‹åˆ°çŠ¶æ€ä¸ä¸€è‡´ï¼Œé‡ç½®åˆ†å±çŠ¶æ€')
      setIsSplit(false)
      setSplitRatio(0.5)
    }
  } catch (error) {
    console.warn('[useSplitScreen] çŠ¶æ€åŒæ­¥å¤±è´¥:', error)
  }
}, [isPrimaryViewCreated, isSplit, setIsSplit, setSplitRatio])

// ğŸ”¥ å…³é”®ä¿®å¤ï¼šç»„ä»¶æŒ‚è½½ååŒæ­¥çŠ¶æ€
useEffect(() => {
  const timer = setTimeout(() => {
    syncSplitStatus()
  }, 500)
  return () => clearTimeout(timer)
}, [syncSplitStatus])

// ğŸ”¥ å…³é”®ä¿®å¤ï¼šçª—å£è·å¾—ç„¦ç‚¹æ—¶åŒæ­¥çŠ¶æ€
useEffect(() => {
  const handleFocus = (): void => {
    syncSplitStatus()
  }
  window.addEventListener('focus', handleFocus)
  return () => window.removeEventListener('focus', handleFocus)
}, [syncSplitStatus])

// ğŸ”¥ å…³é”®ä¿®å¤ï¼šå®šæœŸçŠ¶æ€æ£€æŸ¥
useEffect(() => {
  if (!isPrimaryViewCreated) return

  const interval = setInterval(() => {
    syncSplitStatus()
  }, 5000)

  return () => clearInterval(interval)
}, [isPrimaryViewCreated, syncSplitStatus])
```

---

## è¾¹ç•Œè®¡ç®—ä¿®å¤

### é—®é¢˜æè¿°

**ç°è±¡**ï¼šåˆ†å±çŠ¶æ€ä¸‹å†æ¬¡ç‚¹å‡»å·¦ä¾§ä¸»è§†å›¾çš„é“¾æ¥ï¼Œåˆ†å‰²çº¿ä¼šæ¶ˆå¤±ã€‚

**æ ¹æœ¬åŸå› **ï¼š`handleNavigation` æ–¹æ³•åœ¨è®¡ç®—æ¬¡è§†å›¾è¾¹ç•Œæ—¶ï¼Œ**æ²¡æœ‰è€ƒè™‘ DOM ä¸­ 14px çš„åˆ†å‰²çº¿å®½åº¦**ã€‚

### DOM å¸ƒå±€ vs BrowserView è¾¹ç•Œ

**DOM å¸ƒå±€** (Flexbox):

```
æ€»å®½åº¦: 100%
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ä¸»è§†å›¾: calc(50% - 7px) â”‚ åˆ†å‰²çº¿: 14px â”‚ æ¬¡è§†å›¾: calc(50% - 7px) â”‚
â”‚        (50% - 7px)     â”‚    (14px)    â”‚       (50% - 7px)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**åŸä»£ç ** (é”™è¯¯):

```typescript
// é”™è¯¯ï¼šæ²¡æœ‰è€ƒè™‘åˆ†å‰²çº¿å®½åº¦
const secondaryBounds = {
  x: primaryBounds.x + primaryBounds.width, // é”™è¯¯ï¼šç´§è´´ä¸»è§†å›¾å³ä¾§
  width: windowBounds.width - primaryBounds.width // é”™è¯¯ï¼šå æ»¡å‰©ä½™ç©ºé—´
}
```

**ä¿®å¤å** (æ­£ç¡®):

```typescript
// æ­£ç¡®ï¼šè€ƒè™‘ 14px åˆ†å‰²çº¿å®½åº¦
const dividerWidth = 14

const secondaryBounds = {
  x: primaryBounds.x + primaryBounds.width + dividerWidth, // æ­£ç¡®ï¼šè·³è¿‡åˆ†å‰²çº¿
  width: Math.max(0, windowBounds.width - primaryBounds.width - dividerWidth) // æ­£ç¡®ï¼šå‡å»åˆ†å‰²çº¿å®½åº¦
}
```

### ä¿®å¤ä»£ç 

```typescript
/**
 * ğŸ”¥ å…³é”®ä¿®å¤ï¼šå¤„ç†å¯¼èˆªäº‹ä»¶
 * è¾¹ç•Œè®¡ç®—å¿…é¡»è€ƒè™‘ DOM ä¸­ 14px çš„åˆ†å‰²çº¿å®½åº¦
 */
private handleNavigation(url: string): void {
  if (!this.mainWindow || !this.primaryView) {
    console.warn('[ViewService] æ— æ³•å¤„ç†å¯¼èˆªï¼šä¸»çª—å£æˆ–ä¸»è§†å›¾ä¸å­˜åœ¨')
    return
  }

  // è·å–ä¸»è§†å›¾çš„å½“å‰ä½ç½®
  const primaryBounds = this.primaryView.getBounds()
  const windowBounds = this.mainWindow.getBounds()
  const dividerWidth = 14 // DOM ä¸­åˆ†å‰²çº¿çš„å®½åº¦

  // ğŸ”¥ å…³é”®ä¿®å¤ï¼šè¾¹ç•Œè®¡ç®—å¿…é¡»è€ƒè™‘åˆ†å‰²çº¿å®½åº¦
  // æ¬¡è§†å›¾çš„ x åæ ‡ = ä¸»è§†å›¾å³è¾¹ç•Œ + åˆ†å‰²çº¿å®½åº¦
  // æ¬¡è§†å›¾çš„å®½åº¦ = çª—å£å®½åº¦ - ä¸»è§†å›¾å®½åº¦ - åˆ†å‰²çº¿å®½åº¦
  this.createSecondaryView(url, {
    x: primaryBounds.x + primaryBounds.width + dividerWidth,
    y: primaryBounds.y,
    width: Math.max(0, windowBounds.width - primaryBounds.width - dividerWidth),
    height: primaryBounds.height
  })

  console.log('[ViewService] å¯¼èˆªå·²æ‹¦æˆªï¼Œåœ¨æ¬¡çº§çª—å£æ‰“å¼€:', url)
}
```

### updateSplitRatio ä¸­çš„è¾¹ç•Œè®¡ç®—

`updateSplitRatio` æ–¹æ³•å·²ç»æ­£ç¡®å¤„ç†äº†åˆ†å‰²çº¿å®½åº¦ï¼š

```typescript
updateSplitRatio(ratio: number): void {
  // ...
  const availableWidth = totalWidth - 14 // å‡å»åˆ†å‰²çº¿å®½åº¦

  // æ›´æ–°ä¸»è§†å›¾
  const primaryWidth = Math.round(availableWidth * ratio)

  // æ›´æ–°æ¬¡çº§è§†å›¾
  const secondaryBounds = {
    x: primaryWidth + 14, // SplitDivider å³ä¾§
    width: availableWidth - primaryWidth
  }
}
```

---

## æ—¶åºå›¾

### 1. åº”ç”¨å¯åŠ¨æ—¶åºï¼ˆå«çŠ¶æ€åŒæ­¥ï¼‰

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Main as ä¸»è¿›ç¨‹ (Main)
    participant ViewSvc as ViewService
    participant IPC as IPC Router
    participant Renderer as æ¸²æŸ“è¿›ç¨‹
    participant Store as Zustand Store

    User->>Main: å¯åŠ¨åº”ç”¨
    Main->>Main: app.whenReady()
    Main->>Main: åˆ›å»º BrowserWindow
    Main->>ViewSvc: viewService.setMainWindow(window)
    Main->>IPC: initIPC()
    IPC->>IPC: æ³¨å†Œ IPC è·¯ç”±
    Main->>Renderer: åŠ è½½é¡µé¢
    Renderer->>Renderer: ReactDOM.createRoot()
    Renderer->>Store: åˆå§‹åŒ– Zustand

    Note over Renderer: ğŸ”¥ æ³¨å†ŒçŠ¶æ€åŒæ­¥ç›‘å¬
    Renderer->>Renderer: setTimeout(syncSplitStatus, 500ms)
    Renderer->>Window: addEventListener('focus')
    Renderer->>Renderer: setInterval(syncSplitStatus, 5000ms)

    Renderer->>User: æ˜¾ç¤º HomePage
```

### 2. åˆ›å»ºä¸»è§†å›¾æ—¶åº

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant Home as HomePage
    participant Store as Zustand Store
    participant IPCRenderer as IPC (Renderer)
    participant IPCMain as IPC (Main)
    participant ViewSvc as ViewService
    participant View as BrowserView

    User->>Home: ç‚¹å‡»ç½‘ç«™å›¾æ ‡
    Home->>Store: navigate(url)
    Store->>Store: setPrimaryUrl(url)
    Store->>Store: getElementBounds()
    Store->>IPCRenderer: browserViewIPC.createPrimary()
    IPCRenderer->>IPCMain: invoke(CREATE_PRIMARY_VIEW)
    IPCMain->>ViewSvc: createPrimaryView(url, bounds)
    ViewSvc->>ViewSvc: ç§»é™¤æ—§è§†å›¾
    ViewSvc->>View: new BrowserView()
    ViewSvc->>View: setBounds(bounds)
    ViewSvc->>View: addBrowserView()
    ViewSvc->>View: loadURL(url)
    ViewSvc->>View: æ³¨å…¥æ»šåŠ¨æ¡æ ·å¼
    View-->>ViewSvc: did-finish-load
    ViewSvc-->>IPCMain: è¿”å› viewId
    IPCMain-->>IPCRenderer: è¿”å›ç»“æœ
    IPCRenderer-->>Store: å®Œæˆå›è°ƒ
    Store->>Store: setIsPrimaryViewCreated(true)
    Store-->>User: UI æ›´æ–°æ˜¾ç¤ºä¸»è§†å›¾
```

### 3. è§¦å‘åˆ†å±æ—¶åºï¼ˆå«ä¿®å¤ï¼‰

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant View1 as Primary BrowserView
    participant ViewSvc as ViewService
    participant View2 as Secondary BrowserView
    participant IPCMain as IPC (Main)
    participant Store as Zustand Store
    participant UI as MainView UI

    User->>View1: ç‚¹å‡»é“¾æ¥
    View1->>ViewSvc: will-navigate äº‹ä»¶
    ViewSvc->>ViewSvc: event.preventDefault()

    Note over ViewSvc: ğŸ”¥ å…³é”®ä¿®å¤ï¼šè€ƒè™‘ 14px åˆ†å‰²çº¿å®½åº¦
    ViewSvc->>ViewSvc: handleNavigation(url)
    ViewSvc->>ViewSvc: è®¡ç®—æ¬¡çº§è§†å›¾ä½ç½® (x = primaryWidth + 14)

    alt æ¬¡è§†å›¾å·²å­˜åœ¨
        ViewSvc->>View2: loadURL(url)
        ViewSvc->>ViewSvc: ç¡®ä¿ isSplit = true
        Note over ViewSvc: ğŸ”¥ å…³é”®ä¿®å¤ï¼šå‘é€äº‹ä»¶ç¡®ä¿åŒæ­¥
        ViewSvc->>IPCMain: send(SECONDARY_CREATED)
    else æ¬¡è§†å›¾ä¸å­˜åœ¨
        ViewSvc->>View2: createSecondaryView(url, bounds)
        View2->>View2: setBounds()
        View2->>View2: loadURL(url)
        ViewSvc->>IPCMain: send(SECONDARY_CREATED)
    end

    IPCMain->>Store: è§¦å‘çŠ¶æ€æ›´æ–°
    Store->>Store: setIsSplit(true)
    Store-->>UI: isSplit = true
    UI->>UI: ä¸»è§†å›¾ width: 50% - 7px
    UI->>UI: æ˜¾ç¤ºåˆ†å‰²çº¿ (14px)
    UI->>UI: æ˜¾ç¤ºæ¬¡çº§è§†å›¾ (50% - 7px)
    UI-->>User: åˆ†å±æ•ˆæœå‘ˆç°
```

### 4. çŠ¶æ€åŒæ­¥æ—¶åº

```mermaid
sequenceDiagram
    participant Renderer as æ¸²æŸ“è¿›ç¨‹
    participant Store as Zustand Store
    participant IPCRenderer as IPC (Renderer)
    participant IPCMain as IPC (Main)
    participant ViewSvc as ViewService

    Note over Renderer: è§¦å‘æ¡ä»¶ï¼šæŒ‚è½½/ç„¦ç‚¹/å®šæœŸ
    Renderer->>Store: syncSplitStatus()
    Store->>IPCRenderer: getDetailedSplitStatus()
    IPCRenderer->>IPCMain: invoke(GET_DETAILED_STATUS)
    IPCMain->>ViewSvc: getSplitStatus()
    ViewSvc-->>IPCMain: è¿”å›è¯¦ç»†çŠ¶æ€
    IPCMain-->>IPCRenderer: è¿”å›ç»“æœ
    IPCRenderer-->>Store: è¿”å›è¯¦ç»†çŠ¶æ€

    alt çŠ¶æ€ä¸ä¸€è‡´
        Store->>Store: æ£€æµ‹åˆ° hasSecondaryView=true, isSplit=false
        Store->>Store: setIsSplit(true)
        Note over Store: ä¿®å¤ï¼šåŒæ­¥ä¸»è¿›ç¨‹çŠ¶æ€åˆ°æœ¬åœ°
    else çŠ¶æ€ä¸€è‡´
        Store->>Store: æ— éœ€æ“ä½œ
    end
```

### 5. å…³é—­åˆ†å±æ—¶åºï¼ˆå«ç™½å±ä¿®å¤ï¼‰

```mermaid
sequenceDiagram
    participant User as ç”¨æˆ·
    participant UI as MainView UI
    participant Store as Zustand Store
    participant IPCRenderer as IPC (Renderer)
    participant IPCMain as IPC (Main)
    participant ViewSvc as ViewService
    participant View2 as Secondary BrowserView

    User->>UI: ç‚¹å‡»å…³é—­æŒ‰é’®
    UI->>Store: closeSplit()

    Note over UI: ğŸ”¥ å…³é”®ä¿®å¤ï¼šç«‹å³æ›´æ–° UI
    Store->>Store: setIsSplit(false)
    Store->>Store: setSplitRatio(0.5)
    Store-->>UI: isSplit = false

    Note over UI: æ ·å¼ç«‹å³å˜åŒ–ï¼šbackgroundColor: transparent, visibility: hidden
    UI->>UI: æ¬¡è§†å›¾ç«‹å³é€æ˜ä¸”éšè—

    Store->>IPCRenderer: destroySecondary()
    IPCRenderer->>IPCMain: invoke(DESTROY_SECONDARY)
    IPCMain->>ViewSvc: destroySecondary()
    ViewSvc->>View2: removeBrowserView()
    ViewSvc->>View2: webContents.close()
    ViewSvc->>ViewSvc: æ¢å¤ä¸»è§†å›¾å…¨å®½
    ViewSvc-->>IPCMain: å®Œæˆ
    IPCMain-->>IPCRenderer: å®Œæˆ
    IPCRenderer-->>Store: å®Œæˆ
```

---

## å…³é”®ä»£ç è¯´æ˜

### 1. ä¸‰å±‚æ¶æ„å®ç°

**æ ¸å¿ƒåŸåˆ™**: ä¸šåŠ¡é€»è¾‘ã€IPC é€šä¿¡ã€Electron API ä¸‰å±‚åˆ†ç¦»ã€‚

```typescript
// âŒ ä¸å¥½çš„ä»£ç ï¼ˆä¸‰å±‚æ··åˆï¼‰
function createBrowserView(url: string) {
  const view = new BrowserView() // ç›´æ¥è°ƒç”¨ API
  view.webContents.loadURL(url)

  ipcMain.handle('navigate', () => {
    // ç›´æ¥å¤„ç† IPC
    view.webContents.loadURL(url)
  })

  view.setBounds({ x: 0, y: 0, width: 800, height: 600 }) // ç¡¬ç¼–ç 
}

// âœ… å¥½çš„ä»£ç ï¼ˆä¸‰å±‚åˆ†ç¦»ï¼‰

// 1. ä¸šåŠ¡é€»è¾‘å±‚ - viewService.ts
export class ViewService {
  private views = new Map<string, BrowserView>()

  createView(id: string, url: string): BrowserView {
    const view = new BrowserView({ webPreferences: { sandbox: true } })
    view.webContents.loadURL(url)
    this.views.set(id, view)
    return view
  }
}

// 2. IPC å±‚ - channels.ts
export const IPCChannels = {
  CREATE_BROWSER_VIEW: 'create-browser-view'
} as const

// 3. IPC è·¯ç”± - main.ts
export function setupIpcHandlers(viewService: ViewService) {
  ipcMain.handle(IPCChannels.CREATE_BROWSER_VIEW, (event, id: string, url: string) => {
    return viewService.createView(id, url)
  })
}

// 4. æ¸²æŸ“è¿›ç¨‹å°è£… - browserView.ts
export const browserViewIPC = {
  create: (id: string, url: string) => ipcRenderer.invoke(IPCChannels.CREATE_BROWSER_VIEW, id, url)
}
```

### 2. IPC é€šé“ç®¡ç†

**æ ¸å¿ƒæœºåˆ¶**: æ‰€æœ‰ IPC é€šé“å¿…é¡»ä½¿ç”¨å¸¸é‡ï¼Œç¦æ­¢ç¡¬ç¼–ç ã€‚

```typescript
// src/ipc/channels.ts
/**
 * IPC é€šé“åç§°å¸¸é‡
 * æ‰€æœ‰ IPC é€šä¿¡å¿…é¡»ä½¿ç”¨è¿™äº›å¸¸é‡ï¼Œç¦æ­¢ç¡¬ç¼–ç å­—ç¬¦ä¸²
 */
export const IPCChannels = {
  /** åˆ›å»ºä¸»è§†å›¾ */
  CREATE_PRIMARY_VIEW: 'browser-view:create-primary',
  /** åˆ›å»ºæ¬¡çº§è§†å›¾ */
  CREATE_SECONDARY_VIEW: 'browser-view:create-secondary',
  /** é”€æ¯æ¬¡çº§è§†å›¾ */
  DESTROY_SECONDARY_VIEW: 'browser-view:destroy-secondary',
  /** æ›´æ–°è§†å›¾è¾¹ç•Œ */
  UPDATE_VIEW_BOUNDS: 'browser-view:update-bounds',
  /** è·å–åˆ†å±çŠ¶æ€ */
  GET_STATUS: 'browser-view:get-status',
  /** ğŸ”¥ æ–°å¢ï¼šè·å–è¯¦ç»†åˆ†å±çŠ¶æ€ */
  GET_DETAILED_STATUS: 'browser-view:get-detailed-status',
  /** ğŸ”¥ æ–°å¢ï¼šæ›´æ–°åˆ†å±æ¯”ä¾‹ */
  UPDATE_SPLIT_RATIO: 'browser-view:update-split-ratio',
  /** ğŸ”¥ æ–°å¢ï¼šæ˜¾ç¤ºé®ç½©å±‚ï¼ˆæ‹–åŠ¨æ—¶ä½¿ç”¨ï¼‰ */
  SHOW_OVERLAY: 'browser-view:show-overlay',
  /** ğŸ”¥ æ–°å¢ï¼šéšè—é®ç½©å±‚ */
  HIDE_OVERLAY: 'browser-view:hide-overlay',
  /** æ¬¡çº§è§†å›¾åˆ›å»ºå®Œæˆäº‹ä»¶ */
  SECONDARY_VIEW_CREATED: 'browser-view:secondary-created',
  /** å¯¼èˆªè¢«æ‹¦æˆªäº‹ä»¶ */
  NAVIGATION_BLOCKED: 'browser-view:navigation-blocked'
} as const
```

### 3. çŠ¶æ€åŒæ­¥ Hook å®ç°

```typescript
// src/renderer/src/hooks/useSplitScreenStore.ts

/**
 * ğŸ”¥ å…³é”®ä¿®å¤ï¼šåŒæ­¥åˆ†å±çŠ¶æ€
 * ä¸»åŠ¨æŸ¥è¯¢ä¸»è¿›ç¨‹çŠ¶æ€å¹¶åŒæ­¥æœ¬åœ°çŠ¶æ€
 */
const syncSplitStatus = useCallback(async () => {
  if (!isPrimaryViewCreated) return

  try {
    const detailedStatus = await browserViewIPC.getDetailedSplitStatus()

    // ğŸ”¥ å…³é”®ä¿®å¤ï¼šå¦‚æœä¸»è¿›ç¨‹æœ‰æ¬¡è§†å›¾ä½†æœ¬åœ°çŠ¶æ€æ²¡æœ‰ï¼Œåˆ™åŒæ­¥
    if (detailedStatus.hasSecondaryView && !isSplit) {
      console.log('[useSplitScreen] æ£€æµ‹åˆ°çŠ¶æ€ä¸ä¸€è‡´ï¼ŒåŒæ­¥åˆ†å±çŠ¶æ€')
      setIsSplit(true)
    }

    // ğŸ”¥ å…³é”®ä¿®å¤ï¼šå¦‚æœä¸»è¿›ç¨‹æ²¡æœ‰æ¬¡è§†å›¾ä½†æœ¬åœ°çŠ¶æ€æœ‰ï¼Œåˆ™é‡ç½®
    if (!detailedStatus.hasSecondaryView && isSplit) {
      console.log('[useSplitScreen] æ£€æµ‹åˆ°çŠ¶æ€ä¸ä¸€è‡´ï¼Œé‡ç½®åˆ†å±çŠ¶æ€')
      setIsSplit(false)
      setSplitRatio(0.5)
    }
  } catch (error) {
    console.warn('[useSplitScreen] çŠ¶æ€åŒæ­¥å¤±è´¥:', error)
  }
}, [isPrimaryViewCreated, isSplit, setIsSplit, setSplitRatio])

// ğŸ”¥ å…³é”®ä¿®å¤ï¼šç»„ä»¶æŒ‚è½½ååŒæ­¥çŠ¶æ€
useEffect(() => {
  const timer = setTimeout(() => {
    syncSplitStatus()
  }, 500)
  return () => clearTimeout(timer)
}, [syncSplitStatus])

// ğŸ”¥ å…³é”®ä¿®å¤ï¼šçª—å£è·å¾—ç„¦ç‚¹æ—¶åŒæ­¥çŠ¶æ€
useEffect(() => {
  const handleFocus = (): void => {
    syncSplitStatus()
  }
  window.addEventListener('focus', handleFocus)
  return () => window.removeEventListener('focus', handleFocus)
}, [syncSplitStatus])

// ğŸ”¥ å…³é”®ä¿®å¤ï¼šå®šæœŸçŠ¶æ€æ£€æŸ¥
useEffect(() => {
  if (!isPrimaryViewCreated) return

  const interval = setInterval(() => {
    syncSplitStatus()
  }, 5000)

  return () => clearInterval(interval)
}, [isPrimaryViewCreated, syncSplitStatus])
```

### 4. é˜²ç™½å±æ ·å¼ä¿®å¤

```typescript
// src/renderer/src/pages/MainView.tsx

{/* æ¬¡çº§è§†å›¾å ä½åŒºåŸŸ */}
<div
  ref={secondaryContainerRef}
  className="h-full relative"
  style={{
    // å‡å» 7px ä¸ºåˆ†å‰²çº¿ç•™å‡ºç©ºé—´
    width: isSplit ? `calc(${(1 - splitRatio) * 100}% - 7px)` : '0%',
    flexShrink: 0,
    opacity: isSplit ? 1 : 0,
    overflow: 'hidden',
    // ğŸ”¥ å…³é”®ä¿®å¤ï¼šå…³é—­åˆ†å±æ—¶ç«‹å³éšè—èƒŒæ™¯ï¼Œæ¶ˆé™¤ç™½å±é—ªçƒ
    backgroundColor: isSplit ? '#f3f4f6' : 'transparent',
    visibility: isSplit ? 'visible' : 'hidden',
    // å…³é”®ï¼šæ‹–åŠ¨æ—¶ç¦ç”¨ transitionï¼Œé¿å…é—ªçƒ
    transition: isDragging ? 'none' : 'width 0.3s ease-in-out'
  }}
>
```

---

## è°ƒè¯•å’Œæ’é”™æŒ‡å—

### æŸ¥çœ‹ IPC é€šä¿¡æ—¥å¿—

åœ¨æ§åˆ¶å°å¯ç”¨è¯¦ç»†æ—¥å¿—ï¼š

```typescript
// åœ¨ main.ts æˆ–æ¸²æŸ“è¿›ç¨‹ä¸­æ·»åŠ 
console.log('[IPC] å‘é€:', channel, payload)
console.log('[IPC] æ¥æ”¶:', channel, result)
```

### è°ƒè¯• BrowserView è¾¹ç•Œ

åœ¨ ViewService ä¸­æ·»åŠ è¾¹ç•Œæ—¥å¿—ï¼š

```typescript
private logViewBounds(viewName: string, bounds: ViewBounds): void {
  console.log(`[ViewService] ${viewName} è¾¹ç•Œ:`, {
    x: bounds.x,
    y: bounds.y,
    width: bounds.width,
    height: bounds.height
  })
}
```

### çŠ¶æ€ä¸ä¸€è‡´æ’æŸ¥

æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ä¸­çš„çŠ¶æ€åŒæ­¥ä¿¡æ¯ï¼š

```
[useSplitScreen] æ£€æµ‹åˆ°çŠ¶æ€ä¸ä¸€è‡´ï¼ŒåŒæ­¥åˆ†å±çŠ¶æ€
[useSplitScreen] ä¸»è¿›ç¨‹çŠ¶æ€: {isSplit: true, hasSecondaryView: true}
[useSplitScreen] æœ¬åœ°çŠ¶æ€: {isSplit: false}
[useSplitScreen] æ‰§è¡Œä¿®å¤: setIsSplit(true)
```

### å¸¸è§é—®é¢˜æ’æŸ¥

**Q1: åˆ†å‰²çº¿ä¸æ˜¾ç¤º**

æ£€æŸ¥æ­¥éª¤ï¼š

1. æŸ¥çœ‹ `isSplit` çŠ¶æ€æ˜¯å¦ä¸º `true`
2. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰çŠ¶æ€åŒæ­¥æ—¥å¿—
3. éªŒè¯ `SECONDARY_CREATED` äº‹ä»¶æ˜¯å¦æ­£ç¡®å‘é€
4. ä½¿ç”¨ `getDetailedSplitStatus` æ£€æŸ¥ä¸»è¿›ç¨‹çŠ¶æ€

**Q2: å…³é—­åˆ†å±æ—¶æœ‰ç™½å±**

æ£€æŸ¥æ­¥éª¤ï¼š

1. ç¡®è®¤ `MainView.tsx` ä¸­çš„æ ·å¼ä¿®å¤å·²åº”ç”¨
2. æ£€æŸ¥ `backgroundColor` å’Œ `visibility` æ˜¯å¦æ­£ç¡®è®¾ç½®
3. éªŒè¯ `closeSplit` å‡½æ•°æ˜¯å¦å…ˆæ›´æ–°çŠ¶æ€å†é”€æ¯è§†å›¾

**Q3: åˆ†å±æ¯”ä¾‹è°ƒæ•´ä¸ç”Ÿæ•ˆ**

æ£€æŸ¥æ­¥éª¤ï¼š

1. éªŒè¯ `updateSplitRatio` IPC è°ƒç”¨æ˜¯å¦æˆåŠŸ
2. æ£€æŸ¥ `updateSplitRatio` æ–¹æ³•æ˜¯å¦å‡å» 14px åˆ†å‰²çº¿å®½åº¦
3. æŸ¥çœ‹ BrowserView è¾¹ç•Œæ˜¯å¦æ­£ç¡®æ›´æ–°
4. ç¡®è®¤ DOM å®½åº¦è®¡ç®—ä¸ BrowserView è¾¹ç•Œä¸€è‡´

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. BrowserView åˆ›å»ºå’Œé”€æ¯

**ä¼˜åŒ–å»ºè®®**ï¼š

- é¿å…é¢‘ç¹åˆ›å»º/é”€æ¯ BrowserViewï¼Œé‡ç”¨å·²åˆ›å»ºçš„å®ä¾‹
- ä½¿ç”¨ `webContents.reload()` ä»£æ›¿é”€æ¯åé‡æ–°åˆ›å»º
- å»¶è¿ŸåŠ è½½éæ´»åŠ¨è§†å›¾çš„å†…å®¹

### 2. çŠ¶æ€åŒæ­¥é¢‘ç‡æ§åˆ¶

**å½“å‰å®ç°**ï¼š

- æŒ‚è½½åï¼š500ms å»¶è¿Ÿï¼Œå•æ¬¡æ‰§è¡Œ
- çª—å£ç„¦ç‚¹ï¼šå³æ—¶æ‰§è¡Œ
- å®šæœŸåŒæ­¥ï¼šæ¯ 5 ç§’æ‰§è¡Œ

**ä¼˜åŒ–å»ºè®®**ï¼š

- å¦‚æœåº”ç”¨é•¿æœŸè¿è¡Œï¼Œå¯è€ƒè™‘åŠ¨æ€è°ƒæ•´åŒæ­¥é¢‘ç‡
- åœ¨åˆ†å±æ¨¡å¼ä¸‹å¢åŠ åŒæ­¥é¢‘ç‡ï¼Œéåˆ†å±æ¨¡å¼ä¸‹é™ä½é¢‘ç‡

### 3. CSS Transition æœ€ä½³å®è·µ

**å½“å‰å®ç°**ï¼š

```css
transition: isDragging ? 'none' : 'width 0.3s ease-in-out'
```

**ä¼˜åŒ–å»ºè®®**ï¼š

- æ‹–åŠ¨æ—¶ç¦ç”¨ transition æ˜¯æ­£ç¡®çš„ï¼Œé¿å…æ€§èƒ½é—®é¢˜
- è€ƒè™‘ä½¿ç”¨ `transform` ä»£æ›¿ `width` ä»¥è·å¾—æ›´å¥½çš„æ€§èƒ½ï¼ˆGPU åŠ é€Ÿï¼‰
- ä½†éœ€è¦æ³¨æ„ BrowserView è¾¹ç•Œå¿…é¡»ä¸ DOM åŒæ­¥

### 4. å†…å­˜ç®¡ç†å»ºè®®

**å½“å‰å®ç°**ï¼š

- ç»„ä»¶å¸è½½æ—¶è°ƒç”¨ `destroyAllViews()`
- å…³é—­åˆ†å±æ—¶æ¸…ç†æ¬¡çº§è§†å›¾

**ä¼˜åŒ–å»ºè®®**ï¼š

- æ·»åŠ å†…å­˜ä½¿ç”¨ç›‘æ§
- å®šæœŸæ¸…ç†æœªä½¿ç”¨çš„ BrowserView å®ä¾‹
- ä½¿ç”¨ `webContents.close()` å½»åº•é‡Šæ”¾èµ„æº

---

## IPC é€šé“å®Œæ•´åˆ—è¡¨

| é€šé“å                | ç±»å‹   | å‚æ•°               | è¿”å›å€¼        | ä½¿ç”¨åœºæ™¯         | ä½ç½®           |
| --------------------- | ------ | ------------------ | ------------- | ---------------- | -------------- |
| **BrowserView**       |        |                    |               |                  |                |
| `CREATE_PRIMARY`      | send   | `{url, bounds}`    | -             | åˆ›å»ºä¸»è§†å›¾       | channels.ts:10 |
| `UPDATE_BOUNDS`       | send   | `{type, bounds}`   | -             | æ›´æ–°è§†å›¾è¾¹ç•Œ     | channels.ts:11 |
| `DESTROY_SECONDARY`   | send   | -                  | -             | é”€æ¯æ¬¡çº§è§†å›¾     | channels.ts:12 |
| `DESTROY_ALL`         | send   | -                  | -             | é”€æ¯æ‰€æœ‰è§†å›¾     | channels.ts:13 |
| `GET_STATUS`          | invoke | -                  | `boolean`     | è·å–åˆ†å±çŠ¶æ€     | channels.ts:14 |
| `GET_DETAILED_STATUS` | invoke | -                  | `SplitStatus` | ğŸ”¥ è·å–è¯¦ç»†çŠ¶æ€  | channels.ts:15 |
| `UPDATE_SPLIT_RATIO`  | send   | `{ratio}`          | -             | ğŸ”¥ æ›´æ–°åˆ†å±æ¯”ä¾‹  | channels.ts:18 |
| `SHOW_OVERLAY`        | send   | -                  | -             | ğŸ”¥ æ˜¾ç¤ºé®ç½©å±‚    | channels.ts:21 |
| `HIDE_OVERLAY`        | send   | -                  | -             | ğŸ”¥ éšè—é®ç½©å±‚    | channels.ts:22 |
| `SECONDARY_CREATED`   | on     | `{url, timestamp}` | -             | æ¬¡çº§è§†å›¾åˆ›å»ºäº‹ä»¶ | channels.ts:27 |
| `NAVIGATION_BLOCKED`  | on     | `{fromUrl, toUrl}` | -             | å¯¼èˆªæ‹¦æˆªäº‹ä»¶     | channels.ts:28 |
| **Window**            |        |                    |               |                  |                |
| `RESIZE`              | on     | `{width, height}`  | -             | çª—å£å¤§å°å˜åŒ–     | channels.ts:33 |
| `FOCUS`               | on     | -                  | -             | çª—å£è·å¾—ç„¦ç‚¹     | channels.ts:34 |
| **System**            |        |                    |               |                  |                |
| `GET_VERSION`         | invoke | -                  | `string`      | è·å–åº”ç”¨ç‰ˆæœ¬     | channels.ts:39 |
| `OPEN_EXTERNAL`       | send   | `{url}`            | -             | æ‰“å¼€å¤–éƒ¨é“¾æ¥     | channels.ts:40 |

**ç±»å‹å®šä¹‰** (`src/ipc/types.ts`):

```typescript
// SplitStatus ç±»å‹
interface SplitStatus {
  isSplit: boolean
  hasSecondaryView: boolean
  primaryUrl: string
  secondaryUrl: string
}

// ViewBounds ç±»å‹
interface ViewBounds {
  x: number
  y: number
  width: number
  height: number
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ä¸ºä»€ä¹ˆç‚¹å‡»é“¾æ¥ä¼šè§¦å‘åˆ†å±è€Œä¸æ˜¯åœ¨å½“å‰çª—å£æ‰“å¼€ï¼Ÿ

**åŸå› **: ä¸»è¿›ç¨‹ç›‘å¬äº† `will-navigate` äº‹ä»¶å¹¶è°ƒç”¨äº† `event.preventDefault()`ï¼Œé˜»æ­¢äº†é»˜è®¤å¯¼èˆªè¡Œä¸ºï¼Œæ”¹ä¸ºåˆ›å»ºæ¬¡çº§ BrowserView æ˜¾ç¤ºæ–°é¡µé¢ã€‚

**å…³é”®ä»£ç ä½ç½®**: `src/main/services/viewService.ts:handleNavigation()`

### Q2: åˆ†å±åå¦‚ä½•åŒæ­¥ä¸¤ä¸ªè§†å›¾çš„æ»šåŠ¨ä½ç½®ï¼Ÿ

**ç°çŠ¶**: å½“å‰å®ç°æœªåŒæ­¥æ»šåŠ¨ä½ç½®ï¼Œä¸¤ä¸ªè§†å›¾ç‹¬ç«‹æ»šåŠ¨ã€‚

**æ”¹è¿›å»ºè®®**: å¯é€šè¿‡ `webContents.executeJavaScript()` åœ¨é¡µé¢é—´åŒæ­¥æ»šåŠ¨äº‹ä»¶ã€‚

**å®ç°æ€è·¯**:

```typescript
// åœ¨ä¸»è§†å›¾æ»šåŠ¨æ—¶åŒæ­¥åˆ°æ¬¡çº§è§†å›¾
primaryView.webContents.on('scroll', () => {
  const scrollY = primaryView.webContents.executeJavaScript('window.scrollY')
  secondaryView.webContents.executeJavaScript(`window.scrollTo(0, ${scrollY})`)
})
```

### Q3: ä¸ºä»€ä¹ˆä½¿ç”¨ BrowserView è€Œä¸æ˜¯ iframeï¼Ÿ

**å¯¹æ¯”**:

| ç‰¹æ€§     | BrowserView      | iframe       |
| -------- | ---------------- | ------------ |
| æ€§èƒ½     | ç‹¬ç«‹è¿›ç¨‹ï¼Œæ›´å¥½   | ä¸é¡µé¢åŒè¿›ç¨‹ |
| è·¨åŸŸ     | æ— é™åˆ¶           | å—é™åˆ¶       |
| å¯¼èˆªæ‹¦æˆª | âœ… will-navigate | âŒ å›°éš¾      |
| CSP é™åˆ¶ | æ—                | æœ‰           |
| æ ·å¼æ³¨å…¥ | âœ… insertCSS     | âŒ å›°éš¾      |

### Q4: å¦‚ä½•æ·»åŠ æ–°çš„ IPC åŠŸèƒ½ï¼Ÿ

**æ ‡å‡†æµç¨‹** (å¿…é¡»éµå¾ª):

1. **æ·»åŠ é€šé“å¸¸é‡** (`src/ipc/channels.ts`):

   ```typescript
   export const IPCChannels = {
     // ... ç°æœ‰é€šé“
     NEW_FEATURE: 'new-feature' // æ–°å¢
   } as const
   ```

2. **æ·»åŠ ç±»å‹å®šä¹‰** (`src/ipc/types.ts`):

   ```typescript
   export interface NewFeaturePayload {
     data: string
   }
   ```

3. **å®ç°ä¸»è¿›ç¨‹å¤„ç†** (`src/ipc/main.ts`):

   ```typescript
   this.register(IPCChannels.NEW_FEATURE, async (payload) => {
     return viewService.newFeature(payload)
   })
   ```

4. **æ·»åŠ æ¸²æŸ“è¿›ç¨‹å°è£…** (`src/renderer/src/ipc/browserView.ts`):

   ```typescript
   export const browserViewIPC = {
     // ... ç°æœ‰æ–¹æ³•
     newFeature: (data: string) => ipcRenderer.invoke(IPC_CHANNELS.NEW_FEATURE, { data })
   }
   ```

5. **åœ¨ Zustand ä¸­ä½¿ç”¨** (`src/renderer/src/hooks/useSplitScreenStore.ts`):
   ```typescript
   newFeature: async (data: string) => {
     await browserViewIPC.newFeature(data)
     set({
       /* æ›´æ–°çŠ¶æ€ */
     })
   }
   ```

---

## é™„å½•ï¼šæ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ ipc/                           # IPC é€šä¿¡å±‚ï¼ˆç±»å‹å®‰å…¨ï¼‰â­
â”‚   â”œâ”€â”€ channels.ts                # IPC é€šé“åç§°å¸¸é‡
â”‚   â”œâ”€â”€ types.ts                   # IPC ç±»å‹å®šä¹‰
â”‚   â””â”€â”€ main.ts                    # ä¸»è¿›ç¨‹ IPC è·¯ç”±å™¨
â”œâ”€â”€ main/                          # Electron ä¸»è¿›ç¨‹
â”‚   â”œâ”€â”€ index.ts                   # ä¸»è¿›ç¨‹å…¥å£
â”‚   â””â”€â”€ services/                  # ä¸šåŠ¡æœåŠ¡å±‚ï¼ˆä¸‰å±‚æ¶æ„ï¼‰â­
â”‚       â””â”€â”€ viewService.ts         # BrowserView çº¯ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ preload/                       # Electron é¢„åŠ è½½è„šæœ¬
â”‚   â”œâ”€â”€ index.ts                   # é¢„åŠ è½½å…¥å£
â”‚   â””â”€â”€ index.d.ts                 # ç±»å‹å£°æ˜
â””â”€â”€ renderer/src/                  # React æ¸²æŸ“å™¨è¿›ç¨‹
    â”œâ”€â”€ components/                # React ç»„ä»¶
    â”‚   â””â”€â”€ SplitDivider.tsx       # å¯æ‹–åŠ¨åˆ†å‰²çº¿ç»„ä»¶ â­
    â”œâ”€â”€ hooks/                     # è‡ªå®šä¹‰ Hooks
    â”‚   â””â”€â”€ useSplitScreenStore.ts # Zustand + çŠ¶æ€åŒæ­¥ â­
    â”œâ”€â”€ ipc/                       # æ¸²æŸ“è¿›ç¨‹ IPC å°è£…
    â”‚   â””â”€â”€ browserView.ts         # BrowserView IPC ç±»å‹å®‰å…¨å°è£…
    â”œâ”€â”€ pages/                     # é¡µé¢ç»„ä»¶
    â”‚   â”œâ”€â”€ Home.tsx               # é¦–é¡µ
    â”‚   â””â”€â”€ MainView.tsx           # åˆ†å±ä¸»ç•Œé¢
    â”œâ”€â”€ stores/                    # é…ç½®æ–‡ä»¶
    â”‚   â””â”€â”€ config.ts              # é¢„è®¾ç½‘ç«™é…ç½®
    â”œâ”€â”€ App.tsx                    # æ ¹ç»„ä»¶
    â”œâ”€â”€ main.tsx                   # æ¸²æŸ“å™¨å…¥å£
    â””â”€â”€ RouteConfig.tsx            # è·¯ç”±é…ç½®
```

**æ ¸å¿ƒæ–‡ä»¶**:

- `src/ipc/channels.ts`: IPC é€šé“å¸¸é‡å®šä¹‰
- `src/ipc/types.ts`: IPC ç±»å‹å®šä¹‰ï¼ˆå« SplitStatusï¼‰
- `src/ipc/main.ts`: IPC è·¯ç”±é…ç½®ï¼ˆå« GET_DETAILED_STATUSï¼‰
- `src/main/services/viewService.ts`: BrowserView ä¸šåŠ¡é€»è¾‘ â­ï¼ˆå«çŠ¶æ€åŒæ­¥å’Œè¾¹ç•Œè®¡ç®—ä¿®å¤ï¼‰
- `src/renderer/src/ipc/browserView.ts`: æ¸²æŸ“è¿›ç¨‹ IPC å°è£…ï¼ˆå« getDetailedSplitStatusï¼‰
- `src/renderer/src/hooks/useSplitScreenStore.ts`: Zustand çŠ¶æ€ç®¡ç† â­ï¼ˆå«ä¸‰å±‚åŒæ­¥æœºåˆ¶ï¼‰
- `src/renderer/src/pages/MainView.tsx`: åˆ†å± UI æ¸²æŸ“ï¼ˆå«ç™½å±ä¿®å¤ï¼‰
- `src/renderer/src/components/SplitDivider.tsx`: å¯æ‹–åŠ¨åˆ†å‰²çº¿ç»„ä»¶

---

## å·²è§£å†³é—®é¢˜è®°å½•

### âœ… é—®é¢˜ 1: é‡å¤ç‚¹å‡»ä¸»è§†å›¾æ—¶åˆ†å‰²çº¿æ¶ˆå¤±

**ç°è±¡**: åˆ†å±çŠ¶æ€ä¸‹å†æ¬¡ç‚¹å‡»å·¦ä¾§çª—å£åˆ›å»ºçš„æ–°çª—å£æ— ä¸­é—´æ†å­

**æ ¹æœ¬åŸå› **:

1. `createSecondaryView` æ£€æµ‹åˆ°æ¬¡è§†å›¾å·²å­˜åœ¨æ—¶ï¼Œåªæ›´æ–° URLï¼Œä¸å‘é€ `SECONDARY_CREATED` äº‹ä»¶
2. æ¸²æŸ“è¿›ç¨‹çš„ `isSplit` çŠ¶æ€ä¸ä¸»è¿›ç¨‹ä¸åŒæ­¥

**ä¿®å¤æ–¹æ¡ˆ**:

1. åœ¨ `createSecondaryView` ä¸­ï¼Œå³ä½¿æ¬¡è§†å›¾å·²å­˜åœ¨ä¹Ÿå‘é€ `SECONDARY_CREATED` äº‹ä»¶
2. å®ç°ä¸‰å±‚çŠ¶æ€åŒæ­¥æœºåˆ¶ï¼ˆäº‹ä»¶é©±åŠ¨ + ä¸»åŠ¨æŸ¥è¯¢ + å®šæœŸåŒæ­¥ï¼‰

**å…³é”®ä»£ç **: `viewService.ts:104-119`, `useSplitScreenStore.ts:296-360`

---

### âœ… é—®é¢˜ 2: å…³é—­åˆ†å±æ—¶å‡ºç°ç™½å±é—ªçƒ

**ç°è±¡**: ç‚¹å‡»å…³é—­åˆ†å±æŒ‰é’®ï¼Œå³ä¾§å‡ºç°ä¸€æ®µæ—¶é—´ç™½è‰²åŒºåŸŸ

**æ ¹æœ¬åŸå› **:

1. æ¬¡çº§ BrowserView ç«‹å³è¢«é”€æ¯
2. ä½† UI å®¹å™¨ä»åœ¨æ‰§è¡Œ 300ms çš„ CSS åŠ¨ç”»
3. èƒŒæ™¯è‰² `#f3f4f6` åœ¨åŠ¨ç”»æœŸé—´å¯è§

**ä¿®å¤æ–¹æ¡ˆ**:

1. ä¿®æ”¹æ¬¡çº§è§†å›¾å®¹å™¨æ ·å¼ï¼š`backgroundColor: isSplit ? '#f3f4f6' : 'transparent'`
2. æ·»åŠ  `visibility: isSplit ? 'visible' : 'hidden'`

**å…³é”®ä»£ç **: `MainView.tsx:140-149`

---

### âœ… é—®é¢˜ 3: è¾¹ç•Œè®¡ç®—æœªè€ƒè™‘åˆ†å‰²çº¿å®½åº¦

**ç°è±¡**: åˆ†å±åå†æ¬¡ç‚¹å‡»å·¦ä¾§é“¾æ¥ï¼Œåˆ†å‰²çº¿ä½ç½®ä¸æ­£ç¡®æˆ–æ¶ˆå¤±

**æ ¹æœ¬åŸå› **: `handleNavigation` æ–¹æ³•è®¡ç®—æ¬¡è§†å›¾è¾¹ç•Œæ—¶ï¼Œæ²¡æœ‰è€ƒè™‘ DOM ä¸­ 14px çš„åˆ†å‰²çº¿å®½åº¦

**ä¿®å¤æ–¹æ¡ˆ**:

1. æ¬¡è§†å›¾ x åæ ‡ï¼š`primaryWidth + 14`
2. æ¬¡è§†å›¾å®½åº¦ï¼š`totalWidth - primaryWidth - 14`

**å…³é”®ä»£ç **: `viewService.ts:450-466`

---

_æ–‡æ¡£ç‰ˆæœ¬: 3.0_  
_æœ€åæ›´æ–°: 2026-02-01_  
_ä½œè€…: HMETAO_  
_æ¶æ„ç‰ˆæœ¬: ä¸‰å±‚åˆ†ç¦»æ¶æ„ + çŠ¶æ€åŒæ­¥æœºåˆ¶ (Business â†’ IPC â†’ Electron API)_
